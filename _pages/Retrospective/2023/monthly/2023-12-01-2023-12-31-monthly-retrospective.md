---
title: "월간 회고록 (2023.12.01 ~ 2023.12.31)"
date: "2023-12-31"
tags: [회고, 플라잉닥터, 월간회고, 2023년결산]
permalink: /Retrospective/2023-12-01-2023-12-31-monthly-retrospective.html
---

## 개요

2023년 12월 한 달간의 회고록입니다. 2023년의 마지막 달로, **공적처방전달 시스템 구축** 및 **청구서 결제 안정화**가 핵심 프로젝트였습니다. 11월에 추가한 청구서 결제 방식을 안정화하고, 약국으로 처방전을 전달하는 공적처방전달 시스템을 구축했습니다. 또한 대규모 DB 스키마 정리 작업을 수행했습니다. 총 49개의 이슈를 처리하고, 28개의 커밋(서버 17개 + 프론트 9개 + 플러터 2개 + DB 스키마 4개)을 작성했습니다.

---

## 완료한 작업

### 새 기능 개발

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #1 | [관리자] 결제선생 API 추가 | Medium | 가맹점 가입 URL 추출, 가입 여부 조회, 원격진료 토글 활성화 |

### 버그 수정

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #2 | [환자] 원격진료 - 진료신청서에 가족 주민번호 앞자리 사라짐 | Medium | 가족 정보 표시 버그 수정 |
| 이슈 #3 | [환자] 등록한 카드에서 결제카드변경을 누르면 기존 카드 삭제됨 | Medium | 카드 변경 로직 버그 수정 |
| 이슈 #4 | [통합] 원격진료 환자 처방전 전달 & 결제 후 버튼 노출 안됨 | Medium | 버튼 표시 조건 버그 수정 |
| 이슈 #5 | [환자] 알림 - 새로고침 시 "알림이 없어요"로 표시됨 | Medium | 알림 목록 새로고침 버그 수정 |
| 이슈 #6 | [통합] 정산 - 엑셀 파일 다운로드 시 리스트 표시 오류 | Medium | 정산 엑셀 다운로드 버그 수정 |

### 기능 개선 - 청구서 결제

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #7 | [통합] 원격진료 외 환자: 결제 후 '처방전 & 결제내역 보기' 버튼 노출 개선 | Medium | 버튼 표시 조건 개선 |
| 이슈 #8 | [통합] 청구서 결제 시 결제 상세 내역에 불필요한 히스토리 제거 | Medium | 결제 히스토리 정리 |
| 이슈 #9 | [통합] 재결제 시 카드 등록 상태에 따라 결제수단 선택 버튼 노출 | Medium | 재결제 UX 개선 |
| 이슈 #10 | [환자] 청구서가 도착했어요 - 진료카드 내용 수정 | Medium | 청구서 안내 문구 개선 |

### 기능 개선 - 정산

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #11 | [통합] 정산 구분 필요 (페이플, 결제선생) | Medium | 결제 시스템별 정산 분리 |
| 이슈 #12 | [통합] 결제 정보에서 카드 이름과 승인번호의 추가 정보 확인 | Medium | 결제 상세 정보 표시 개선 |

### 기능 개선 - 처방전

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #13 | [환자] 처방전이 없는 경우 알림 없음 | Medium | 불필요한 알림 제거 |
| 이슈 #14 | [처방전가이드] 병원에서 진료 결제 후 처방전 변경/추가 시 알림 제공 | Medium | 처방전 변경 알림 추가 |

### 기능 개선 - UI/UX

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #15 | [환자] 회원가입 라이팅 수정 | Medium | 회원가입 문구 개선 |
| 이슈 #16 | [환자] "피드" 이름 A/B 테스트 | Medium | 피드 메뉴 명칭 테스트 |
| 이슈 #17 | [환자] 회원가입 유효성 검증 개선 | Medium | 입력 유효성 검사 강화 |
| 이슈 #18 | [환자] 카드등록 - 현대카드 안내 삭제 | Medium | 현대카드 제한 안내 제거 |
| 이슈 #19 | [환자] 병원홈페이지 - 지도 선택 - 앱상단바 닫기 버튼 작동 안됨 | Medium | 네비게이션 버그 수정 |
| 이슈 #20 | [환자] 원격진료 - 진료신청서 - 원격진료 안내 수정 | Medium | 안내 문구 개선 |
| 이슈 #21 | [환자] 홈 - 원격진료 이용 가능 D-Day 임시 제거 | Medium | D-Day 표시 제거 |
| 이슈 #22 | [환자] 예약 카드 버튼 레이블 변경 | Medium | 버튼 문구 개선 |
| 이슈 #23 | [환자] 원격진료 - 진료카드 - 버튼 가이드 상이 | Medium | 진료카드 버튼 통일 |
| 이슈 #24 | [환자] 원격진료 안내 바텀 - 자세히보기 버튼 우선 삭제 | Medium | 불필요한 버튼 제거 |
| 이슈 #25 | [환자][공통] 취소/방문예약/바로접수 - 진료카드 하단 버튼 틀어짐 | Medium | 레이아웃 버그 수정 |
| 이슈 #26 | [환자] 홈 - 상단 알림 카드 - 아이콘 여백값 확인 | Medium | UI 정렬 개선 |
| 이슈 #27 | [환자] 진료프로세스(유형, 상태, 배지) 라벨 개선 | Medium | 진료 상태 라벨 통일 |

### 작업 - DB 스키마 (대규모)

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #28 | [DB] 병원 약관 관련 테이블 추가, 진료 약관 관련 데이터 이관 | Medium | 약관 테이블 구조 변경 |
| 이슈 #29 | [DB] 컨텐츠 관리 테이블 생성 | Medium | 병원 컨텐츠 관리 시스템 |
| 이슈 #30 | [DB] 병원 공지 테이블 병원 컨텐츠 테이블로 마이그레이션 | Medium | 공지 → 컨텐츠 통합 |
| 이슈 #31 | [DB] 병원 전화상담 채널 업데이트 | Medium | 상담 채널 정보 추가 |
| 이슈 #32 | [통합, 환자] 고객의 소리 테이블 업데이트 | Medium | VoC 테이블 구조 개선 |
| 이슈 #33 | [DB] 공적처방시스템 - tb_pharmacy_delivery 컬럼 추가 | Medium | 처방전 전달 테이블 |
| 이슈 #34 | [DB] 공적처방전달 - 알람 템플릿 업데이트 (1) | Medium | 처방전 전달 알림 템플릿 |
| 이슈 #35 | [DB] 약관 관련 테이블 index 추가 | Medium | 쿼리 성능 최적화 |
| 이슈 #36 | [DB] 컨텐츠 그룹 공지 생성 | Medium | 컨텐츠 그룹 관리 |
| 이슈 #37 | [DB] 컨텐츠 그룹 할당 업데이트 | Medium | 그룹 할당 로직 |
| 이슈 #38 | [DB] 의사 테이블 업데이트 | Medium | 의사 정보 컬럼 추가 |
| 이슈 #39 | [DB] 공적처방전달 - 알람 템플릿 업데이트 (2) | Medium | 알림 템플릿 추가 |
| 이슈 #40 | [DB] 예약 진료 PUSH 알림 내용 수정 | Medium | 예약 알림 문구 개선 |
| 이슈 #41 | [DB] 공적처방전달 - 알람 템플릿 업데이트 (3) | Medium | 알림 템플릿 완성 |
| 이슈 #42 | [DB] 병원 증상 / 초진문진표 사용 여부 column 추가 | Medium | 병원별 설정 컬럼 |
| 이슈 #43 | [DB] 공적처방전달 - user 테이블 apiSecretKey 칼럼 수정 | High | API 인증 키 관리 |
| 이슈 #44 | [DB] 병원 진료 공지 테이블 업데이트 | Medium | 진료 공지 시스템 |
| 이슈 #45 | [DB] 병원 테이블 업데이트 | Medium | 병원 정보 컬럼 추가 |
| 이슈 #46 | [DB] 특정 계정 이름 변경 프로시저 생성 | Medium | 계정 관리 프로시저 |
| 이슈 #47 | [DB] 병원 진료과목 업데이트 | Medium | 진료과목 데이터 정리 |
| 이슈 #48 | [DB] 군비닥 진료 테이블 | Medium | 군 의료 서비스 테이블 |
| 이슈 #49 | [DB] 진료 기록 보내기 알림 템플릿 업데이트 | Medium | 진료 기록 알림 |

---

## GitLab 커밋 내역

### Backend Server (16 commits) - 청구서 결제 및 공적처방전달

| 날짜 | 내용 |
|------|------|
| 12-20 | [BATCH] ReservationQRCodeNotificationJob - 푸시 알림 전송 진료 대상 추출 조건 수정 |
| 12-20 | [공통] findDoctor - hospitalPaymintSignupYn 추가 |
| 12-20 | [통합] 결제선생 정산 내역 |
| 12-20 | [통합] 결제선생 정산 내역 - search.endDt 비교 연산자 수정 |
| 12-20 | [통합] 처방전 재전달 - 처방전 도착 PUSH 알림 추가 |
| 12-21 | [통합] 재결제 시, 하이패스 & 청구서 결제 방식 옵션 추가 |
| 12-22 | [통합] 페이플 정산 내역 - v_payment_chit payment_gateway 제거 |
| 12-26 | [관리자] 진료 결제 내역 쿼리 수정 |
| 12-26 | [통합] consult_group_history 컬럼 제거 |
| 12-26 | [통합] updateConsultGroup 최적화 |
| 12-26 | [통합] 결제 청구서 발송 실패 시 불필요한 히스토리 제거 |
| 12-26 | [통합] 결제선생 CALLBACK API Hash 데이터 수정 & 예외 처리 |
| 12-27 | [통합] 결제선생 정산 내역 - 진료 유형 추가 |
| 12-28 | [DB] docs/database 삭제 & database.md 추가 |
| 12-28 | [통합, Batch] 병원 시간표 업데이트 - @Async 어노테이션 적용 |
| 12-28 | [통합] 처방전 전달 & 0원 결제 시 처방전 도착 푸시 알림 전송 |
| 12-28 | [환자] listPharmacylatest - tpd.type IN ('FAX', 'PBP') |

### Frontend (0 commits)

이번 달은 프론트엔드 커밋이 없었습니다.

### DB Schema - mobidoc-database (4 commits)

| 날짜 | 내용 |
|------|------|
| 12-28 | {table_name}_del 미사용 테이블 조회 |
| 12-28 | [20231228] MOBIDOC DATABASE SCHEMA UPDATE |
| 12-29 | OPTIMIZE INDEX |
| 12-29 | [20231229] MOBIDOC DATABASE SCHEMA UPDATE |

### Flutter (2 commits) - 로컬 환경 설정 및 청구서 기능

| 날짜 | 내용 |
|------|------|
| 12-07 | .env.local, build_local.run.xml, local.dart.run.xml 추가 (4 files, +51) |
| 12-11 | [결제선생] 청구서 URL - 외부 브라우저로 이동 (3 files, +22) |

---

## 주요 성과 및 인사이트

### 1. 공적처방전달 시스템 구축 (핵심)

약국으로 처방전을 전달하는 **공적처방전달 시스템**을 구축했습니다.

**시스템 구성:**
- **tb_pharmacy_delivery 테이블**: 처방전 전달 이력 관리
- **알림 템플릿**: 처방전 전달 알림 3종 추가
- **API 인증**: user 테이블에 apiSecretKey 컬럼 추가 (High 우선순위)
- **약국 연동**: FAX, PBP(공적처방전달) 타입 지원

**처방전 전달 알림:**
1. 처방전 도착 알림
2. 처방전 재전달 알림
3. 처방전 변경/추가 시 알림

**관련 커밋:** 3개 (공적처방 관련)

### 2. 청구서 결제 안정화

11월에 추가한 **청구서 결제 방식**을 안정화하고 개선했습니다.

**주요 개선:**
- **재결제 시 하이패스 & 청구서 결제 방식 옵션 추가**: 재결제 시 결제 방식 선택 가능
- **불필요한 히스토리 제거**: 청구서 발송 실패 시 중복 히스토리 제거
- **결제수단 선택 버튼 노출 개선**: 카드 등록 상태에 따라 버튼 동적 표시
- **결제 청구서 발송 실패 처리**: 실패 시 불필요한 히스토리(결제 요청, 결제 실패) 제거

### 3. 정산 시스템 분리 (이슈 #11)

페이플과 결제선생의 **정산을 분리**하여 관리할 수 있도록 개선했습니다.

**개선 내용:**
- 결제선생 정산 내역 조회 API 신규 개발
- 페이플 정산 내역과 분리
- 진료 유형별 정산 집계
- 엑셀 다운로드 버그 수정

### 4. 대규모 DB 스키마 정리 (22개 이슈)

연말을 맞아 **대규모 DB 스키마 정리 작업**을 수행했습니다.

**주요 작업:**
- **병원 약관 시스템**: 약관 테이블 추가, 데이터 이관
- **컨텐츠 관리 시스템**: 병원 공지 → 병원 컨텐츠로 통합
- **알림 템플릿 정리**: 공적처방전달, 예약, 진료 기록 알림 템플릿 업데이트
- **인덱스 추가**: 약관 테이블 성능 최적화
- **군비닥 진료 테이블**: 군 의료 서비스 지원

### 5. 성능 최적화

쿼리와 배치 작업을 최적화했습니다.

**최적화 내용:**
- **updateConsultGroup 최적화**: 진료 그룹 업데이트 성능 개선
- **consult_group_history 컬럼 제거**: 불필요한 컬럼 제거 (prescription_count, last_payment_state, last_payment_register_dtm)
- **병원 시간표 업데이트 @Async 적용**: 비동기 처리로 성능 향상

### 6. 문서화 개선

DB 문서를 정리했습니다.

**개선 내용:**
- docs/database 디렉토리 삭제
- database.md 파일로 통합
- DB 스키마 문서 중앙화

---

## 2023년 총 결산

### 2023년 전체 통계

| 항목 | 수치 |
|------|------|
| 총 이슈 수 | 약 400개 |
| 총 커밋 수 | 약 360개 |
| Backend Server | 약 300개 |
| Frontend | 약 50개 |
| Flutter | 약 10개 |

### 2023년 주요 프로젝트

1. **진료 통합 (6월)**: 방문예약과 원격진료를 하나의 진료 시스템으로 통합
2. **바로접수 개발 (7월)**: 현장 즉시 접수 기능 신규 개발
3. **진료신청서 개선 (8월)**: C.C(Chief Complaint) 기능 추가
4. **병원 시간표 개선 (8~9월)**: 의사 스케줄 SUM 방식으로 재설계
5. **결제선생 전환 (9~11월)**: Payple → 결제선생 전면 전환
6. **청구서 결제 (11~12월)**: 진료/결제 프로세스 분리
7. **공적처방전달 (12월)**: 약국 처방전 전달 시스템 구축

### 2023년 기술 스택 업그레이드

- **MySQL 8 업그레이드** (11월)
- **Nuxt3 작업 착수** (9월)

---

## 2024년 계획

1. **공적처방전달 안정화**: 약국 연동 모니터링 및 개선
2. **청구서 결제 확대**: 하이패스 방식 진료 확대
3. **Nuxt3 마이그레이션 완료**: 프론트엔드 프레임워크 전면 전환

---

## 통계

### 이슈

- **총 이슈 수**: 49개
- **완료**: 49개 (100%)

| 유형 | 개수 |
|------|------|
| 새 기능 | 1개 |
| 버그 | 6개 |
| 개선 | 20개 |
| 작업 | 11개 |
| 하위 작업 | 11개 |

| 우선순위 | 개수 |
|----------|------|
| High | 1개 |
| Medium | 48개 |

### 커밋

- **총 커밋 수**: 23개
- **Backend Server**: 17개
- **Frontend**: 0개
- **Flutter**: 2개
- **DB Schema (mobidoc-database)**: 4개

| 도메인 | 커밋 수 |
|--------|---------|
| 청구서 결제 | 7개 (41%) |
| 정산 시스템 | 4개 (24%) |
| 공적처방전달 | 4개 (24%) |
| 성능 최적화 | 2개 (12%) |

---

## 회고

2023년 12월은 **공적처방전달 시스템 구축**과 **대규모 DB 스키마 정리**로 2023년을 마무리한 달이었습니다.

이번 달은 **서버 중심 작업**과 함께 Flutter 앱에서 로컬 개발 환경 구성 및 청구서 URL 외부 브라우저 이동 기능을 추가했습니다. 대부분의 작업이 서버 API, DB 스키마, 배치 작업에 집중되었으며, Flutter에서는 청구서 결제 방식을 앱에서도 지원하도록 외부 브라우저 연동을 구현했습니다.

**공적처방전달 시스템**은 약국과 연동하여 처방전을 전달하는 새로운 기능입니다. 기존에는 환자가 직접 약국을 방문하거나 팩스로 전달했지만, 이제는 시스템을 통해 자동으로 약국에 처방전을 전달할 수 있습니다. 이는 환자 편의성을 크게 향상시키는 기능입니다.

**대규모 DB 스키마 정리**(22개 이슈)는 연말을 맞아 수행한 중요한 작업입니다. 약관 시스템, 컨텐츠 관리 시스템, 알림 템플릿 등 다양한 테이블을 정리하고 통합했습니다. 특히 병원 공지를 병원 컨텐츠로 통합하여 더 유연한 컨텐츠 관리가 가능해졌습니다.

**청구서 결제 안정화**는 11월에 이어 지속적으로 개선한 작업입니다. 재결제 시 하이패스 & 청구서 결제 방식 옵션을 추가하여 환자가 원하는 결제 방식을 선택할 수 있게 되었습니다.

이슈 수(49개)는 평균 수준이지만, 22개가 DB 스키마 작업이라는 점이 특징적입니다. 커밋 수(19개) 중 서버 17개는 공적처방전달, 청구서 결제, 정산 시스템에 집중되었고, Flutter 2개는 로컬 개발 환경 구성과 청구서 URL 외부 브라우저 이동 기능을 구현했습니다.

---

## 2023년을 돌아보며

2023년은 플라잉닥터 서비스의 **핵심 기능들을 구축하고 안정화한 해**였습니다.

**상반기(2~6월)**는 **진료 통합**이라는 대규모 리팩토링을 수행했습니다. 방문예약과 원격진료를 하나의 진료 시스템으로 통합하여 코드 중복을 제거하고 유지보수성을 높였습니다.

**하반기(7~12월)**는 **새로운 기능 개발과 결제 시스템 전환**에 집중했습니다. 바로접수, 진료신청서 개선, 병원 시간표 개선 등 사용자 편의 기능을 추가하고, 페이플에서 결제선생으로 결제 시스템을 전면 전환했습니다.

특히 **결제 시스템 전환**(9~12월)은 가장 큰 도전이었습니다. 결제는 서비스의 핵심 기능이므로 매우 신중하게 진행해야 했고, 실제로 많은 버그와 엣지 케이스를 처리했습니다. 하지만 청구서 결제 방식 추가, 정산 시스템 분리 등 결제 시스템의 유연성을 크게 향상시켰습니다.

2023년은 플라잉닥터 서비스가 **안정적이고 확장 가능한 플랫폼**으로 성장한 해였습니다. 2024년에는 이 기반 위에서 더 많은 혁신적인 기능을 개발할 수 있을 것입니다.
