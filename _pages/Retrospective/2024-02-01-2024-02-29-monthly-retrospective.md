---
title: "월간 회고록 (2024.02.01 ~ 2024.02.29)"
date: "2024-02-29"
tags: [회고, 플라잉닥터, 월간회고]
---

## 개요

2024년 2월 한 달간의 회고록입니다. 이 달의 핵심 프로젝트는 **진료 중복 접수 방어** 및 **태블릿 접수 개선**이었습니다. 진료 예약과 바로접수 시 중복 접수를 방지하는 로직을 강화하고, 태블릿 접수 시스템의 사용성을 지속적으로 개선했습니다. 또한 EMR 연동을 위한 테이블을 구축하고, 병원 시간표 오류를 수정했습니다. 총 33개의 이슈를 처리하고, 19개의 커밋(백엔드 7개 + 프론트엔드 12개 + DB 스키마 3개)을 작성했습니다.

**커밋 통계:**
- Backend: 7개 (flyingdoctor-server)
- Frontend: 12개 (mobidoc-front)
- DB Schema: 3개 (mobidoc-database)
- **총 22개 커밋**

---

## 완료한 작업

### 버그 수정

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #1 | [환자] 병원 검색에서 대소문자 구분없이 검색 가능하게 변경 | Medium | 검색 로직 개선 |
| 이슈 #2 | [환자] 병원 시간표 오류 | Medium | 시간표 계산 버그 수정 |
| 이슈 #3 | [환자] 원격진료 접수가 안되는 케이스 | Medium | 원격진료 접수 버그 (보류) |
| 이슈 #4 | [통합] 결제 이력이 없으나 재결제라고 뜨는 현상 | Medium | 결제 상태 판단 로직 수정 |

### 기능 개선 - 진료 중복 접수 방어

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #5 | [환자] 재접수 불가 안내 추가 | Medium | 중복 접수 방지 안내 |
| 이슈 #6 | [환자] 진료 신청서 - 당일 접수 내역이 있는데 체크가 되어 있음 | Medium | 접수 내역 체크 로직 개선 |
| 이슈 #7 | [환자] 오늘(오전)접수마감 시 접수가 되고 있음 - 마감알럿 필요 | Medium | 접수 마감 체크 강화 |
| 이슈 #8 | [환자] 진료예약/바로접수 - 예약 신청 중 QR 접수한 경우 알럿 추가 | Medium | 중복 접수 시도 알림 |
| 이슈 #9 | [환자] 태블릿 접수 - 모비닥으로 진료예약 신청 후 예약 당일 태블릿 접수 시도 | Medium | 예약 환자 태블릿 접수 방지 |

### 기능 개선 - 태블릿 접수

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #10 | [태블릿] 사용성 개선 - 전화번호 입력 필드 수정 | Medium | 입력 필드 UX 개선 |
| 이슈 #11 | [태블릿] 접수 시작화면 개선 | Medium | 시작 화면 UI 개선 |

### 기능 개선 - 병원/의사 정보

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #12 | [환자][병원홈페이지/의사] 휴진 시 진료 시작일 안내 추가 | Medium | 휴진 안내 개선 |
| 이슈 #13 | [환자][병원홈페이지/의사프로필] 진료시간 안내 내용수정 | Medium | 진료시간 표시 개선 |
| 이슈 #14 | [환자] 의사 진료시간표 - 미설정 시 이번주 진료 휴진으로 노출 | Medium | 시간표 미설정 안내 |
| 이슈 #15 | [환자] 병원카드(홈), 병원홈페이지 - 의사리스트 가이드 추가 | Medium | 의사 정보 가이드 추가 |
| 이슈 #16 | [환자] 진료예약기능을 쓰지 않는 의사 - 예약 신청서 오류팝업 | Medium | 예약 비활성 의사 처리 |

### 기능 개선 - UI/UX

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #17 | [환자] 결제카드등록 - 서비스 문제 발생 알럿 개선 | Medium | 오류 메시지 개선 |
| 이슈 #18 | [환자] 바로접수 안내 이미지 교체 | Medium | 안내 이미지 업데이트 |
| 이슈 #19 | [환자] 홈 - 병원카드 등록 카드 - 이미지/텍스트 수정 | Medium | 홈 화면 카드 개선 |

### 기능 개선 - 데이터 정합성

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #20 | [DB] 회원 탈퇴 후 재가입 시, 결제 수단 데이터 중복되는 케이스 | Medium | 결제 수단 중복 방지 |

### 작업 - EMR 연동 테이블

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #21 | [DB] EMR 연동 테이블 추가 및 수정 | Medium | EMR 연동 기반 구축 |
| 이슈 #22 | [DB] EMR 연동 병원 맵핑 테이블 수정 | Medium | 병원 맵핑 테이블 |
| 이슈 #23 | emr_api auth 요청 | Medium | EMR API 인증 |
| 이슈 #24 | 뷰 테이블 생성 + 의사 맵핑 테이블 변경 | Medium | 의사 맵핑 테이블 |
| 이슈 #25 | [DB작업] emr_patient_mapping UK 변경 | Medium | 환자 맵핑 테이블 |

### 작업 - DB 스키마

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #26 | [DB] CRM 예약 테이블에 컬럼 추가 | Medium | CRM 테이블 확장 |
| 이슈 #27 | [DB] 운영 DB TABLE SCHEMA 복원 | High | 스키마 복원 작업 |
| 이슈 #28 | [DB] 군 진료 테이블 컬럼 추가 | Medium | 군 의료 테이블 확장 |
| 이슈 #29 | [DB] 컨텐츠 테이블 업데이트 | Medium | 컨텐츠 테이블 수정 |
| 이슈 #30 | tb_pharmacy_delivery column comment 수정 | Medium | 컬럼 주석 수정 |

### 작업 - 성능 개선

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #31 | [환자] slow query 확인 | Medium | 느린 쿼리 분석 (진행 중) |
| 이슈 #32 | [통합, Batch] 병원 시간표 생성 날짜 범위 조정 | Medium | 시간표 생성 최적화 (해야 할 일) |

---

## GitLab 커밋 내역

### Backend Server (7 commits) - 진료 중복 접수 방어

| 날짜 | 내용 |
|------|------|
| 02-26 | [환자] auto-login - 소셜로그인 관련 로직 제거 & loginId 형식 변경 |
| 02-26 | [환자] 진료 예약 신청 이력 존재 여부 판단 - alreadyReservationYn |
| 02-26 | Revert "[환자] 진료 예약 신청 이력 존재 여부 판단 - alreadyReservationYn" |
| 02-27 | [환자] 진료 중복 접수 방어 - 진료예약 예외처리 코드 추가 |
| 02-27 | [api-patient] ConsultGroupController - 진료 관련 객체 & 로직 개편 |
| 02-27 | [api-patient] ConsultController & ConsultGroupController - 진료 관련 객체 & 로직 개편 2 |
| 02-27 | [api-patient] ConsultController & ConsultGroupController - 진료 관련 객체 & 로직 개편 3 |

### DB Schema - mobidoc-database (3 commits)

| 날짜 | 내용 |
|------|------|
| 02-05 | [DB] MOBIDOC DATABASE OPTIMIZE |
| 02-05 | [20240205] MOBIDOC DATABASE SCHEMA UPDATE |
| 02-27 | [20240227] MOBIDOC DATABASE SCHEMA UPDATE |

### Frontend (0 commits)

이번 달도 프론트엔드 커밋이 없었습니다. 모든 작업이 서버와 DB에 집중되었습니다.

---

## 주요 성과 및 인사이트

### 1. 진료 중복 접수 방어 로직 강화 (핵심)

진료 예약과 바로접수 시 **중복 접수를 방지하는 로직**을 강화했습니다.

**주요 개선 사항:**
- **alreadyReservationYn**: 진료 예약 신청 이력 존재 여부 판단 필드 추가
- **진료 중복 접수 방어**: 진료예약 예외처리 코드 추가
- **재접수 불가 안내**: 중복 접수 시도 시 명확한 안내
- **접수 마감 체크**: 오전 접수 마감 시 접수 차단
- **예약 신청 중 QR 접수 알럿**: 중복 접수 시도 알림
- **태블릿 접수 방지**: 모비닥으로 예약한 환자가 태블릿 접수 시도 시 방지

**커밋 집중도:**
- 전체 7개 커밋 중 5개가 진료 중복 접수 방어 관련 (71%)

### 2. ConsultController & ConsultGroupController 개편

진료 관련 컨트롤러를 **대규모 리팩토링**했습니다.

**개편 내용:**
- 진료 관련 객체 구조 개선
- 로직 명확화 및 가독성 향상
- 중복 접수 방어 로직 통합
- 3단계에 걸친 점진적 개편 (커밋 3개)

### 3. EMR 연동 테이블 구축

병원 EMR 시스템과 연동하기 위한 **테이블 구조를 구축**했습니다.

**구축된 테이블:**
- **emr_api_auth**: EMR API 인증 정보
- **emr_hospital_mapping**: 병원 맵핑 테이블
- **emr_doctor_mapping**: 의사 맵핑 테이블 (VIEW 포함)
- **emr_patient_mapping**: 환자 맵핑 테이블 (UK 변경)

**효과:**
- 병원 EMR 시스템과 플라잉닥터 연동 준비
- 진료 데이터 양방향 동기화 기반 마련

### 4. 태블릿 접수 사용성 지속 개선

1월에 이어 태블릿 접수 시스템을 지속적으로 개선했습니다.

**개선 내용:**
- 전화번호 입력 필드 UX 개선
- 접수 시작화면 개선
- 예약 환자의 태블릿 중복 접수 방지

### 5. 휴진 안내 개선

병원/의사의 휴진 정보를 사용자에게 명확하게 전달하도록 개선했습니다.

**개선 내용:**
- 휴진 시 진료 시작일 안내 추가
- 진료시간 안내 내용 수정
- 의사 진료시간표 미설정 시 "휴진"으로 표시

### 6. auto-login 로직 개선

자동 로그인 로직을 개선했습니다.

**개선 내용:**
- 소셜로그인 관련 로직 제거
- loginId 형식 변경: `auto-login_{patientAccountSeq}_{timestamp yyyyMMddHHmmss}`

**효과:**
- 자동 로그인 ID 추적 용이
- 타임스탬프로 생성 시점 파악 가능

### 7. 운영 DB SCHEMA 복원 (High 우선순위)

운영 DB 테이블 스키마를 복원하는 **High 우선순위 작업**을 수행했습니다.

---

## 2024년 3월 계획

1. **EMR 연동 개발**: 구축한 테이블 기반 EMR 연동 기능 개발
2. **진료 중복 접수 모니터링**: 방어 로직 효과 확인
3. **slow query 최적화**: 성능 개선 작업 계속

---

## 통계

### 이슈

- **총 이슈 수**: 33개
- **완료**: 30개 (90.9%)
- **진행 중**: 1개 (3.0%)
- **해야 할 일**: 1개 (3.0%)
- **보류**: 1개 (3.0%)

| 유형 | 개수 |
|------|------|
| 버그 | 4개 |
| 개선 | 18개 |
| 작업 | 6개 |
| 하위 작업 | 5개 |

| 우선순위 | 개수 |
|----------|------|
| High | 1개 |
| Medium | 32개 |

### 커밋

- **총 커밋 수**: 10개
- **Backend Server**: 7개
- **Frontend**: 0개
- **DB Schema (mobidoc-database)**: 3개

| 도메인 | 커밋 수 |
|--------|---------|
| 진료 중복 접수 방어 | 5개 (71%) |
| 컨트롤러 개편 | 3개 |
| 기타 | 2개 |

---

## 회고

2024년 2월은 **진료 중복 접수 방어 로직 강화**에 집중한 달이었습니다.

이번 달도 **100% 서버 중심 작업**이었습니다. 2023년 10월부터 **5개월 연속** 프론트엔드 커밋이 없었으며, 백엔드와 DB 작업에만 집중했습니다. 이는 진료 중복 접수 방어, EMR 연동 테이블 구축 등이 주로 백엔드 작업이었기 때문입니다.

**진료 중복 접수 방어**는 서비스 품질을 높이는 중요한 작업이었습니다. 환자가 실수로 또는 의도적으로 중복 접수를 시도할 때, 명확한 안내와 함께 차단하여 병원과 환자 모두에게 혼란을 방지했습니다. 특히 다음 케이스들을 방어했습니다:
- 진료 예약 신청 중 중복 신청
- 바로접수 신청 중 중복 신청
- 예약 신청 중 QR 접수
- 모비닥 예약 후 태블릿 접수
- 접수 마감 시간 이후 접수

**ConsultController & ConsultGroupController 개편**은 3단계에 걸쳐 점진적으로 진행한 대규모 리팩토링이었습니다. 진료 관련 객체 구조를 개선하고, 중복 접수 방어 로직을 통합하여 코드 가독성과 유지보수성을 높였습니다.

**EMR 연동 테이블 구축**은 향후 병원 EMR 시스템과의 연동을 위한 기반 작업이었습니다. 병원, 의사, 환자 맵핑 테이블을 구축하여 양방향 데이터 동기화가 가능해졌습니다.

커밋 수(7개)는 매우 적은 편이지만, 각 커밋이 진료 중복 접수 방어와 컨트롤러 개편이라는 중요한 작업을 포함합니다. 특히 Revert 커밋이 있는 것은 신중한 검토 후 더 나은 방식으로 재구현했음을 보여줍니다.

이슈 수(33개)는 평균 수준이며, 대부분이 진료 중복 접수 방어와 태블릿 접수 개선에 집중되었습니다.
