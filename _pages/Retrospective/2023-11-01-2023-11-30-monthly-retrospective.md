---
title: "월간 회고록 (2023.11.01 ~ 2023.11.30)"
date: "2023-11-30"
tags: [회고, 플라잉닥터, 월간회고]
---

## 개요

2023년 11월 한 달간의 회고록입니다. 이 달의 핵심 프로젝트는 **결제선생 안정화** 및 **청구서 결제 방식 추가**였습니다. 10월에 전면 도입한 결제선생의 다양한 오류를 수정하고, 원격진료와 하이패스 결제를 위한 청구서 결제 방식을 새롭게 추가했습니다. 또한 MySQL 8 업그레이드라는 중요한 인프라 작업을 수행했습니다. 총 45개의 이슈를 처리하고, 30개의 커밋(서버 30개 + 프론트 0개)을 작성했습니다.

---

## 완료한 작업

### 에픽 - 청구서 결제 방식 추가

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #1 | [통합, 환자] 업데이트 - 원격진료, 하이패스 결제: 청구서 결제 방식 추가 | Medium | 청구서 기반 후불 결제 시스템 개발 |

### 버그 수정 - 결제 관련

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #2 | [통합] 서버의 오류로 진료비 결제실패 | Medium | 결제선생 서버 오류 처리 |
| 이슈 #3 | [환자] 진료비 결제 - 승인 & 결제 취소 시 카드 정보 상이함 | Medium | 카드 정보 표시 불일치 수정 |
| 이슈 #4 | [통합] 결제 상세 - 함께 진료를 받은 환자 수와 비례하여 결제 내역이 보여지는 문제 | Medium | 결제 내역 중복 표시 오류 |
| 이슈 #5 | [환자, 통합] 처방전 - 비대면진료 & 환자 연락처가 기재 안되는 경우 | Medium | 처방전 연락처 누락 문제 |

### 버그 수정 - 통계 및 관리자

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #6 | [관리자] 병원 진료 완료 및 취소 건수 오류 | High | 통계 집계 오류 긴급 수정 |
| 이슈 #7 | [통합] 병원 관리 통계 - 결제 건, 총 결제 금액 산정 오류 | Medium | 정산 금액 계산 오류 수정 |

### 버그 수정 - 기타

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #8 | [환자] 예약 신청 시 푸시알림 안옴 | Medium | 알림 발송 오류 (보류) |

### 기능 개선 - 결제 프로세스

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #9 | [환자] 결제 실패 시 앱바 - 처방전/처방전 저장 삭제 | Medium | 결제 실패 시 UI 개선 |
| 이슈 #10 | [환자] 진료비 결제 실패 후 환자앱에서 재결제 시 푸시알림 개선 | Medium | 재결제 알림 개선 |
| 이슈 #11 | [환자] 처방전 - 결제하기 가이드 | Medium | 결제 프로세스 가이드 추가 |
| 이슈 #12 | [환자] 카드 등록 - 진료비 자동 결제 안내 문구 수정 | Medium | 안내 문구 개선 |
| 이슈 #13 | [환자] 결제 - 현대카드 결제 불가 안내 | Medium | 현대카드 제한 안내 |

### 기능 개선 - 방문예약

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #14 | [환자] 비회원 접수 시 진료 접수 중/완료 문자 내용 추가 | Low | 대기번호 안내 추가 |
| 이슈 #15 | [환자] 방문예약일이 아닌 경우 예약카드로 QR 접수하는 케이스 추가 | Low | 예약 외 QR 접수 허용 |
| 이슈 #16 | [환자] 방문예약 진입 시 예약시간 설정 모달 미표시 | Medium | 예약 시간 선택 모달 수정 |
| 이슈 #17 | [환자] 방문예약 중 예약시간을 다시 선택해야할 경우 안내 가이드 추가 | Medium | 시간 재선택 가이드 |
| 이슈 #18 | [환자] 예약 - 노쇼 취소 안내 추가 | Lowest | 노쇼 패널티 안내 |

### 기능 개선 - 진료신청서

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #19 | [환자] 진료신청 - 약관동의 - 텍스트와 화살표 상하 센터 정렬 | Medium | UI 정렬 수정 |
| 이슈 #20 | [환자] 비회원 QR접수(초진) - 주민등록번호 뒷자리 입력 이동 버튼 이슈 | Medium | 입력 폼 버그 수정 |
| 이슈 #21 | [환자] 원격진료 - 진료신청서 - 결제카드 등록 후 신청서에 미반영 | Medium | 카드 등록 상태 동기화 |
| 이슈 #22 | [환자] 주소 추가 후 재추가 시 전에 추가한 주소 남아있음 | Medium | 주소 입력 초기화 버그 |
| 이슈 #23 | [환자] 증상 입력에서 새로고침하면 버튼의 위치가 바뀜 | Medium | 새로고침 버그 수정 |

### 기능 개선 - 처방전

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #24 | [환자] 처방전 신청 - 지도 - 약국 정보 칸 밀림 현상 | Medium | 레이아웃 버그 수정 |
| 이슈 #25 | [환자] 약국 팩스 전송 카드 - 텍스트 underline | Medium | UI 스타일 개선 |
| 이슈 #26 | [환자] 진료탭 - 처방전 보기 - 상단 뒤로가기 버튼 선택 시 진료탭으로 이동 | Medium | 네비게이션 버그 수정 |
| 이슈 #27 | [환자] 처방전 이미지 뒤에 불필요한 그림자 | Medium | UI 개선 |
| 이슈 #28 | [환자] 약국 선택 화면에서 X아이콘 이미지 상이 | Medium | 아이콘 일관성 개선 |

### 기능 개선 - UI/UX

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #29 | [환자] 인증번호 일치하지 않음 모달 호출 후 로그인됨 | Medium | 인증 플로우 버그 수정 |
| 이슈 #30 | [환자] 병원홈페이지 - 원격/방문예약 없는 경우 하단 배경 표시 | Medium | 레이아웃 개선 |
| 이슈 #31 | [환자] 병원홈페이지 - 병원소식 - 좌우 간격 상이 | Medium | 그리드 정렬 수정 |
| 이슈 #32 | [환자] 갤럭시 폴더블 폰 - 의사 리스트 - 이름이 잘리고 있음 | Medium | 반응형 레이아웃 개선 |
| 이슈 #33 | [환자] 전체 - 새로고침 시 상단에 푸터부터 보임 | Medium | 스크롤 위치 버그 수정 |
| 이슈 #34 | [환자] 공지사항 - 본문 - 날짜 공백 확인 | Medium | 날짜 포맷 수정 |

### 기능 개선 - 관리자

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #35 | [관리자] 진료 결제 내역 | Medium | 결제 내역 조회 기능 개선 |
| 이슈 #36 | [관리자] 진료/예약조회 - 환자상세 - 카드 정보 | Medium | 카드 정보 표시 추가 |

### 기능 개선 - 기타

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #37 | [환자, 통합] 원격진료 예상 대기시간이 맞지 않을 때가 있음 | Medium | 대기시간 계산 로직 개선 |

### 작업 - 인프라

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #38 | [DB] MySQL 8 업그레이드 | Medium | MySQL 5.7 → 8.0 업그레이드 |

### 작업 - DB 스키마

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #39 | [DB] Payple 데이터 삭제 | Medium | 구 결제 시스템 데이터 정리 (보류) |
| 이슈 #40 | [DB] 진료 약관 동의 이력 데이터 수정 | Medium | 약관 이력 테이블 수정 |
| 이슈 #41 | [DB] 선택 약관 관련 column, data 추가 | Medium | 선택 약관 컬럼 추가 |
| 이슈 #42 | [DB] CRM 예약 테이블 업데이트 | Medium | CRM 데이터 정리 |
| 이슈 #43 | [DB] 병원 및 알림 템플릿 테이블 업데이트 | Medium | 템플릿 테이블 수정 |
| 이슈 #44 | [DB] 피드 발행일 컬럼 추가 | Medium | 피드 테이블 컬럼 추가 |

### 작업 - 기타

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #45 | [환자] 플라잉닥터 사업자 정보 수정 | Medium | 사업자 정보 업데이트 |

---

## GitLab 커밋 내역

### Backend Server (30 commits) - 결제선생 안정화 및 청구서 결제

| 날짜 | 내용 |
|------|------|
| 11-14 | [결제선생] 삼성카드 OTC 오류로 인한 결제실패 - 결제 실패 푸시알림 중지 |
| 11-14 | [통합, 관리자] 병원관리, 진료현황판 - 통계 건 수 기준 일시 수정 |
| 11-14 | [통합] 결제 상세 - 함께 진료를 받은 환자 수 비례 결제 내역 표시 문제 수정 |
| 11-14 | [통합] 병원 관리 통계 - 결제 건, 총 결제 금액 산정 오류 수정 |
| 11-14 | [환자] 진료 상세 - 결제 완료, 결제 취소 각 카드 정보 상이 이슈 수정 |
| 11-15 | [결제선생] rpManage PaymintCreditCardVO.Update.builder() updateId 수정 |
| 11-15 | [결제선생] 결제선생 가맹점 가입 여부 DB 반영 checkHospitalPaymintSignUp 수정 |
| 11-15 | [결제선생] 재결제 0원 결제 허용 |
| 11-15 | [통합, 관리자] 통계 쿼리 getStatisticsInfo 개선 |
| 11-16 | [결제선생] PaymintPaymentStateCode - ERROR 추가 |
| 11-16 | [관리자] 환자 결제 이력 - 결제 카드 상세 정보 필드 추가 |
| 11-16 | [전체] 결제금액 SubQuery 수정 - pcd_pay_total |
| 11-16 | [통합] 0원 재결제 - Signal 시점 수정 |
| 11-16 | [통합] 0원 재결제 - bill_id 수정 |
| 11-16 | [통합] 0원 재결제 후, 100원 이상 결제 허용 |
| 11-16 | [통합] 0원 재결제 후, 100원 이상 결제 허용 (예외처리 제외) |
| 11-16 | [통합] 결제 실패 - 진료 Signal Update |
| 11-16 | [통합] 재결제 0원 결제 허용 - bill_id, appr_state 수정 & Signal 전송 |
| 11-16 | [통합] 재결제 0원 결제 허용 - payment, payment_consult 데이터 추가 |
| 11-16 | [환자] 본인인증 예외 메시지 수정 |
| 11-17 | [결제선생] BillRP 결제 실패 - 데이터 추가 (결과코드, 결과메시지) |
| 11-17 | [결제선생] BillRP 결제 실패 - 데이터 추가 (결제수단, 카드사, 카드번호) |
| 11-17 | [결제선생] BillRP 결제 실패 - 환자 결제 수단 유효성 검사 |
| 11-20 | [결제선생] BILL RP CALLBACK 유효성 검사 수정 |
| 11-20 | [결제선생] 결제 상태 조회 후, INSERT (CALLBACK API 오류 발생 시 긴급 처리) |
| 11-20 | [관리자] 진료 결제 내역 |
| 11-21 | [환자] ApiServiceErrorCode CLOSED_SCHEDULE("E40207") 추가 |
| 11-23 | [환자] 결제 카드 등록 CALLBACK API - findCreditCard Query 수정 |
| 11-27 | [결제선생] log 개행 추가 및 개선 |
| 11-29 | [결제선생] 테스터버전 API KEY 변경 |

### Frontend (0 commits)

이번 달은 프론트엔드 커밋이 없었습니다. 모든 작업이 서버 중심으로 진행되었습니다.

---

## 주요 성과 및 인사이트

### 1. 결제선생 안정화 (핵심)

10월에 전면 도입한 **결제선생(Paymint)**의 다양한 오류를 수정하고 안정화했습니다.

**주요 수정 내용:**
- **0원 재결제 허용**: 재결제 시 0원 결제 허용, 이후 100원 이상 결제 가능
- **삼성카드 OTC 오류**: 결제 실패 푸시알림 중지
- **결제 실패 처리**: BillRP 결제 실패 시 데이터 추가 (결과코드, 결과메시지, 카드정보)
- **CALLBACK 오류 처리**: CALLBACK API 오류 발생 시 결제 상태 조회 후 INSERT (긴급 처리)
- **유효성 검사**: BillRP 결제 실패 시 환자 결제 수단 유효성 검사
- **로깅 개선**: log 개행 추가 및 개선

**안정화 커밋:** 15개 (전체의 50%)

### 2. 청구서 결제 방식 추가 (에픽)

원격진료와 하이패스 결제를 위한 **청구서 결제 방식**을 새롭게 추가했습니다.

**기존 방식:**
- 진료 완료 → 즉시 카드 결제 (CON-COM 상태)

**새로운 방식:**
- 진료 완료 → 청구서 발행 → 환자가 나중에 결제
- 진료와 결제 프로세스 분리

**장점:**
- 환자 편의성 향상 (즉시 결제 부담 감소)
- 하이패스 방식 진료 지원
- 결제 실패 시 재결제 프로세스 간소화

### 3. MySQL 8 업그레이드 (이슈 #38)

데이터베이스를 **MySQL 5.7에서 8.0으로 업그레이드**했습니다.

**업그레이드 효과:**
- 성능 향상 (쿼리 최적화, 인덱싱 개선)
- 윈도우 함수, CTE 등 새로운 SQL 기능 사용 가능
- 보안 강화
- JSON 함수 성능 개선

### 4. 통계 집계 오류 수정 (이슈 #6, #7)

병원 관리 통계의 심각한 오류를 수정했습니다.

**수정 내용:**
- 병원 진료 완료 및 취소 건수 오류 (High 우선순위)
- 결제 건, 총 결제 금액 산정 오류
- 통계 쿼리 getStatisticsInfo 개선
- 진료현황판 통계 건 수 기준 일시 수정

### 5. 처방전 결제 프로세스 개선

처방전 관련 결제 프로세스를 대폭 개선했습니다.

**개선 내용:**
- 결제 실패 시 앱바에서 처방전/처방전 저장 삭제
- 재결제 시 푸시알림 개선
- 결제하기 가이드 추가
- 처방전 이미지 UI 개선 (불필요한 그림자 제거)

### 6. 방문예약 안내 강화

방문예약 관련 안내와 가이드를 추가했습니다.

**추가된 안내:**
- 비회원 접수 시 대기번호 안내 문자
- 방문예약일이 아닌 경우 QR 접수 케이스 추가
- 예약시간 재선택 가이드
- 노쇼 취소 안내

---

## 2023년 12월 계획

1. **청구서 결제 안정화**: 신규 도입된 청구서 결제 방식 모니터링
2. **결제선생 모니터링**: 안정화 작업 효과 확인
3. **연말 정산**: 2023년 결제 데이터 정산 및 검증

---

## 통계

### 이슈

- **총 이슈 수**: 45개
- **완료**: 41개 (91.1%)
- **보류**: 3개 (6.7%)
- **진행 중**: 1개 (2.2%)

| 유형 | 개수 |
|------|------|
| 에픽 | 2개 |
| 버그 | 6개 |
| 개선 | 24개 |
| 작업 | 11개 |
| 하위 작업 | 2개 |

| 우선순위 | 개수 |
|----------|------|
| High | 1개 |
| Medium | 41개 |
| Low | 2개 |
| Lowest | 2개 |

### 커밋

- **총 커밋 수**: 30개
- **Backend Server**: 30개 (100%)
- **Frontend**: 0개 (0%)

| 도메인 | 커밋 수 |
|--------|---------|
| 결제선생 안정화 | 15개 (50%) |
| 통계/정산 | 5개 |
| 기타 | 10개 |

---

## 회고

2023년 11월은 **결제선생 안정화**에 집중한 달이었습니다.

이번 달의 가장 큰 특징은 **100% 서버 중심 작업**이었다는 점입니다. 프론트엔드 커밋이 단 하나도 없었으며, 모든 작업이 서버 API, 결제 로직, DB 작업에 집중되었습니다. 이는 결제선생 안정화와 청구서 결제 방식 추가가 주로 백엔드 작업이었기 때문입니다.

**결제선생 안정화**는 10월 전면 도입 후 발생한 다양한 엣지 케이스를 처리하는 작업이었습니다:
- 0원 재결제 허용
- 삼성카드 OTC 오류 처리
- CALLBACK API 오류 시 긴급 처리 로직
- 결제 실패 시 상세 데이터 기록

특히 **CALLBACK API 오류 시 결제 상태 조회 후 INSERT**는 결제선생 서버가 불안정할 때를 대비한 안전장치입니다. CALLBACK이 실패하더라도 결제 상태를 직접 조회하여 데이터를 보존하는 방식입니다.

**청구서 결제 방식 추가**는 진료와 결제 프로세스를 분리하는 중요한 변화였습니다. 기존에는 진료 완료 즉시 결제가 이루어졌지만, 이제는 청구서를 발행하고 환자가 나중에 결제할 수 있습니다. 이는 하이패스 방식 진료를 지원하고, 환자 편의성을 높이는 개선입니다.

**MySQL 8 업그레이드**는 인프라 개선의 중요한 마일스톤입니다. 성능 향상과 새로운 SQL 기능 사용이 가능해져, 향후 쿼리 최적화와 기능 개발에 큰 도움이 될 것입니다.

이슈 수(45개)는 역대 최다 수준이지만, 대부분 결제선생 관련 버그 수정과 UI 개선이었습니다. 커밋 수(30개)는 이전 달들에 비해 적은 편이지만, 각 커밋이 결제 안정성이라는 중요한 목표를 향해 집중되었습니다.
