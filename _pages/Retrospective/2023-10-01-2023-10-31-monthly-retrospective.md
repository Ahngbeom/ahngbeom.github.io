---
title: "월간 회고록 (2023.10.01 ~ 2023.10.31)"
date: "2023-10-31"
tags: [회고, 플라잉닥터, 월간회고]
---

## 개요

2023년 10월 한 달간의 회고록입니다. 이 달의 핵심 프로젝트는 **결제선생 전면 도입** 및 **알림 시스템 개선**이었습니다. 기존 페이플에서 결제선생으로의 완전 전환을 완료하고, 방문예약/피드 관련 알림 시스템을 강화했습니다. 총 21개의 이슈를 처리하고, 42개의 커밋(서버 30개 + 프론트 11개 + 플러터 1개 + DB 스키마 1개)을 작성했습니다.

---

## 완료한 작업

### 버그 수정

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #1 | [환자] QR 스캔하면 로그인페이지로 이동하는 현상 | Medium | QR 접수 시 잘못된 리다이렉션 수정 |
| 이슈 #2 | [통합] 병원관리 - 정산 - 엑셀 파일과 정산 페이지 내 금액 상이 | Highest | 정산 금액 불일치 긴급 수정 |
| 이슈 #3 | [통합] 병원관리 - 정산 - 엑셀 파일 추출 시 계산식 오류 | Medium | 엑셀 추출 계산식 버그 수정 |

### 기능 개선

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #4 | [환자] 진료신청서 - 증상 입력 유도안내 팝업 삭제 | Medium | 불필요한 팝업 제거 |
| 이슈 #5 | [환자] 원격진료/방문예약/바로접수 후 안내 바텀시트 이미지 교체 | Medium | 안내 이미지 업데이트 |
| 이슈 #6 | [환자] 피드 받은 사람 리마인드 알림 | Medium | 피드 전송 3일차 리마인드 알림 추가 |

### 작업 - 결제선생 연동

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #7 | [통합] 결제선생 미등록 병원 - 원격진료 Switch 클릭 시 Modal 호출 | Highest | 결제선생 미등록 병원 안내 Modal |
| 이슈 #8 | [환자] 방문예약 - 날짜가 지나도 예약됨 | Medium | 예약 날짜 유효성 검사 |
| 이슈 #9 | [DB] 결제선생 | Medium | 결제선생 DB 스키마 작업 |
| 이슈 #10 | [환자] 사업자 정보 수정 - 통신판매번호 추가 | Medium | 사업자 정보 표시 개선 |

### 작업 - DB 스키마

| 이슈 | 제목 | 우선순위 | 설명 |
|------|------|----------|------|
| 이슈 #11 | [DB] CRM 예약 그룹 업데이트 | Medium | CRM 데이터 정리 |
| 이슈 #12 | [DB] 피드 추천 테이블 업데이트 및 데이터 재삽입 | Medium | 피드 추천 테이블 send_dtm 컬럼 추가 |
| 이슈 #13 | [DB] mobidoc_notice 스키마 추가 요청 | Medium | 모비닥 공지 테이블 생성 |
| 이슈 #14 | [DB] 병원 접수 마감 업데이트 | Medium | 휴일 상태 프로시저 생성 |
| 이슈 #15 | [DB] 방문예약 진료 접수 요청 및 완료 PUSH 알림 데이터 수정 | Medium | 알림 템플릿 수정 |
| 이슈 #16 | [DB] faq, faq_category 스키마 추가 요청 | Medium | 자주 묻는 질문 테이블 생성 |
| 이슈 #17 | [DB] 모든 의사 원격진료 OFF | Medium | 결제선생 미가입 병원 의사 비활성화 |
| 이슈 #18 | [DB] tb_doctor.history 구분자 변경 | Medium | 의사 이력 데이터 구분자 수정 |
| 이슈 #19 | [DB] hospital_voc 테이블 생성 | Medium | 병원 고객의 소리(VoC) 테이블 생성 |
| 이슈 #20 | [DB] tb_patient_alarm_template 피드 리마인드 알림 추가 | Medium | 피드 리마인드 알림 템플릿 추가 |

---

## GitLab 커밋 내역

### Backend Server (30 commits) - 결제선생 연동 및 알림 시스템

| 날짜 | 내용 |
|------|------|
| 10-04 | [환자] 초진 문진표 작성 데이터 저장 API 수정 |
| 10-04 | [환자] 회원가입 시 hospital_patient 가족 데이터 patient_account_seq 할당 |
| 10-05 | [통합, 공통] 초진 문진표 데이터 조회 쿼리 수정 |
| 10-05 | [통합, 환자] 초진 문진표 작성 데이터 저장 API 수정 |
| 10-05 | [환자] hospitalPatientService.updatePatientAccountSeq 호출 위치 수정 |
| 10-20 | [결제선생] API 연동 - Payple → 결제선생 전환 |
| 10-20 | [결제선생] payment_consult payment_reason 컬럼 추가 |
| 10-20 | [환자] 진료내역 추출 API - 병원명 목록 추출 로직 추가 |
| 10-23 | [환자] 방문예약 당일 QR 접수 신청 및 완료 PUSH 알림 전송 로직 추가 |
| 10-24 | [환자] 방문예약 PUSH 알림 전송 로직 추가 및 내용 수정 |
| 10-25 | [결제선생] application.properties 정리 |
| 10-25 | [환자] findConsultGroup - patient_relation_yn 추가 |
| 10-25 | [환자] listHospitalFilterByConsultGroup - 병원 SEQ 추가 |
| 10-26 | [결제선생] 가맹점 가입 URL 요청 & 가맹점 가입 조회 수정 |
| 10-26 | [환자] 결제선생 결제 카드 등록 member, merchant 수정 |
| 10-26 | [환자] 병원 고객의 소리 전송 API 추가 |
| 10-27 | [결제선생] 모비닥 전용 API-KEY, MEMBER, MERCHANT 수정 |
| 10-27 | [환자] 피드 전송 3일차 리마인드 PUSH 알림 추가 |
| 10-30 | [결제선생] /paymint/bill/rp/callback log 추가 |
| 10-30 | [결제선생] /rp/manage/callback log 추가 |
| 10-30 | [결제선생] DOCTOR_API_HOST 수정 |
| 10-30 | [결제선생] spring.profiles.active 조건문 추가 |
| 10-30 | [결제선생] Payple 등록된 결제 카드 정보 삭제 |
| 10-31 | [TEST] 병원 시간표 & 의사 스케줄 - INSERT & UPDATE Executor |
| 10-31 | [결제선생] member, merchant = hospitalAlias |
| 10-31 | [결제선생] 처방전 전달 & 결제 API 요청 시 CON-COM 상태 변경 |
| 10-31 | [통합] 의사 리스트 조회 API - 원격 진료 가능 여부 필드 추가 |

### Frontend (1 commit)

| 날짜 | 내용 |
|------|------|
| 10-26 | Merge branch 'stag' |

### DB Schema - mobidoc-database (1 commit)

| 날짜 | 내용 |
|------|------|
| 10-06 | [RELEASE:20231006] UPDATE DDL |

### Flutter (1 commit) - 결제선생 앱 연동

| 날짜 | 내용 |
|------|------|
| 10-19 | [결제선생] 운영버전 HOST 추가 & 자동결제 수단 등록/변경 후 뒤로가기 예외처리 |

---

## 주요 성과 및 인사이트

### 1. 결제선생 전면 도입 (핵심)

9월에 착수한 **결제선생(Paymint) 연동**을 이번 달에 완료하고 전면 도입했습니다.

**주요 작업:**
- **Payple → 결제선생 전환**: 기존 Payple API를 결제선생 API로 완전 교체
- **가맹점 관리**: 가맹점 가입 URL 요청, 가입 조회 기능 구현
- **결제 카드 등록**: member, merchant 정보 처리 로직 구현
- **Callback 처리**: 결제 및 관리 callback 로직 구현 및 로깅 추가
- **환경 설정**: application.properties 정리, spring.profiles.active 조건 추가

**결제선생 미등록 병원 처리:**
- 미등록 병원의 의사는 원격진료 OFF 상태로 설정
- 원격진료 Switch 클릭 시 "결제 서비스 연동이 필요해요" Modal 표시
- 채널톡으로 상담 연결 가능하도록 안내

### 2. 방문예약 알림 시스템 강화 (이슈 #15)

방문예약 관련 알림을 개선하고 새로운 알림 유형을 추가했습니다.

**추가된 알림:**
- **방문예약 접수 중**: 방문예약 진료 신청 시
- **방문예약 접수 완료**: 예약일, 병원명, 의사명 포함
- **방문 예약일 확인 (D-1)**: 예약 전날 리마인드
- **진료 접수 중/완료**: 당일 QR 접수 시

### 3. 피드 리마인드 알림 (이슈 #6)

피드를 전송받은 환자에게 **3일차에 리마인드 알림**을 발송하는 기능을 추가했습니다.

**알림 내용:**
- "{병원명}에서 {환자명}님을 위해 준비한 글을 읽어보셨나요? 지금 확인해보세요."

### 4. 새 테이블 생성

여러 신규 테이블을 생성했습니다:

**mobidoc_notice (모비닥 공지)**
- 공지사항/이벤트 관리
- soft delete 지원 (delete_dtm)

**faq, faq_category (자주 묻는 질문)**
- 카테고리: 앱 이용, 진료, 결제, 처방약, 기타
- 첨부 이미지 지원

**hospital_voc (병원 고객의 소리)**
- 환자가 병원에 불편한 점을 전달할 수 있는 VoC 기능

### 5. 정산 엑셀 계산식 오류 수정 (이슈 #2, #3)

정산 페이지와 엑셀 파일 간 금액이 불일치하는 긴급 버그를 수정했습니다.
- 임시 조치: 엑셀 다운로드 버튼 숨김
- 근본 해결: 계산식 오류 수정

### 6. 초진 문진표 개선

초진 문진표 작성 및 조회 로직을 개선했습니다:
- 데이터 저장 API 수정
- 회원가입 시 hospital_patient 가족 데이터 연결 (patient_account_seq 할당)

---

## 2023년 11월 계획

1. **결제선생 안정화**: 전면 도입 후 모니터링 및 버그 수정
2. **알림 시스템 모니터링**: 신규 알림 발송 현황 확인
3. **FAQ/공지사항 기능 개발**: 신규 생성된 테이블 기반 기능 개발

---

## 통계

### 이슈

- **총 이슈 수**: 21개
- **완료**: 21개 (100%)

| 유형 | 개수 |
|------|------|
| 버그 | 3개 |
| 개선 | 3개 |
| 작업 | 4개 |
| 하위 작업 | 11개 |

| 우선순위 | 개수 |
|----------|------|
| Highest | 2개 |
| Medium | 19개 |

### 커밋

- **총 커밋 수**: 33개
- **Backend Server**: 30개
- **Frontend**: 1개
- **Flutter**: 1개
- **DB Schema (mobidoc-database)**: 1개

| 도메인 | 커밋 수 |
|--------|---------|
| 결제선생 연동 | 15개 (48%) |
| 알림 시스템 | 5개 |
| 초진 문진표 | 5개 |
| 기타/테스트 | 6개 |

---

## 회고

2023년 10월은 **결제선생 전면 도입**이라는 대규모 마이그레이션을 완료한 달이었습니다.

이번 달 가장 큰 특징은 **서버 중심의 작업**이었다는 점입니다. 전체 32개 커밋 중 30개(93.8%)가 서버 커밋으로, 대부분 백엔드 API와 DB 작업에 집중했습니다. Flutter 앱에서는 결제선생 운영 HOST 추가 및 자동결제 수단 관련 예외처리를 수행했습니다.

**결제선생 연동**은 9월부터 시작하여 10월에 완료한 장기 프로젝트였습니다. 특히 주의가 필요했던 부분은:
1. 기존 Payple 결제 데이터와의 호환성 유지
2. 결제선생 미등록 병원에 대한 처리 (원격진료 OFF, 안내 Modal)
3. Callback URL 처리 및 로깅

**알림 시스템 강화**도 주요 성과입니다. 방문예약 관련 알림 5종과 피드 리마인드 알림을 추가하여 사용자와의 커뮤니케이션을 강화했습니다.

또한 **mobidoc_notice, faq, hospital_voc** 등 신규 테이블을 생성하여 향후 공지사항, FAQ, 고객의 소리 기능 개발의 기반을 마련했습니다.

이슈 수(21개)와 커밋 수(32개) 모두 이전 달들에 비해 적은 편이지만, 결제선생 연동이라는 고도의 집중이 필요한 작업에 투입했기 때문입니다. 새로운 결제 시스템으로의 전환은 서비스의 핵심 기능 중 하나이므로, 이번 달의 작업은 매우 중요한 의미를 가집니다.
