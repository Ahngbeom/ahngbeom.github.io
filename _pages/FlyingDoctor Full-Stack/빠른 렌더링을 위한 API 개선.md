---
title: "빠른 렌더링을 위한 검색 API 개선"
date: "2025-08-14"
thumbnail: "/assets/img/thumbnail/book.jpg"
order: 2
tags:
    - Spring Boot
    - REST API
    - Java
    - Vue
    - Nuxt.js
    - TypeScript
---

# Legacy

`부가 정보 조회 쿼리 분리 및 데이터 병합` 방식으로 개편 작업 후 테스트 해본 결과

> ## 서버
>
> - 복잡한 쿼리로 인한 DB 단에서의 체류 시간이 해소되었다.
> - 각각의 역할, 목적에 따른 데이터 조회와 병합이 명확히 분리되어 코드 가독성과 유지보수성이 향상되었다.
> - 맵 구조를 사용하여 병원의 부가 데이터를 병합하는 방식을 통해 메모리를 효율적으로 사용한다.
> - 슬로우 쿼리 현상은 해소되었지만, 하나의 API 요청에서 DB 접근 횟수가 증가되었다.
>
> ## 클라이언트
>
> - API 응답 속도는 크게 개선되지 않았다.
> - 해당 개선 작업의 목적은 기존보다 클라이언트 단에서 빠르게 데이터를 전달 받아 빠르게 렌더링할 수 있도록 하는 것이었는데,
> - 결국 API 응답 속도가 크게 개선되지 않음으로 인해 해결하지 못한 것으로 판단된다. (슬로우 쿼리 현상만 해결)

따라서 다른 방식을 고안한 끝에 API를 분리하는 방식을 시도해보았다.

어떠한 데이터 집합을 별도 API로 분리할 지 클라이언트 단 페이지의 구조를 살펴보았다.

![검색 페이지 구조](/assets/img/attach/d9b69b97-0bc8-4b43-8516-26e2557276a9.png)

병원 검색 페이지에서는 키워드에 따른 검색 결과를 빠르게 얻어내기 위해 미리 전체 병원 리스트를 조회하여 저장한다.
기본적으로 필요한 정보는 병원명, 원격진료 활성화 여부, 예약 신청 가능 여부, 바로 접수 신청 가능 여부, 진료 과목 리스트이다.

기존에는 즉시 필요하지 않은 데이터까지 조회, 저장하는 과정으로 인해 응답속도 저하, 메모리 사용량이 많았었다.
현재는 즉시 필요한 데이터만을 조회, 저장, 전달하여 속도, 비용을 최적화하였다.

**진료예약 신청 가능 여부를 알기 위해서는 각 병원의 진료실 정보 기준으로 판단해야하기 때문에**
**getAll 메소드 내부 로직에 조회된 병원들의 진료실 정보를 Map 형태로 가져와 HospitalDto 객체와 맵핑하여 데이터를 저장한다.**

**즐겨찾기한 병원 리스트는 모비닥 APP 계정 SEQ에 종속적이기 때문에 별도 API를 통해 데이터를 전달받는다.**

**/hospital/favorites API의 응답 형식도 Map 형태로 전달하여 클라이언트 단에서 조금이나마 빠르게 데이터를 탐색, 색인할 수 있도록 설계하였다.**

**병원 운영 시간 정보는 검색 결과 페이지에서만 표시하면 되기에**
**검색 결과 리스트가 필터링되었을 때, 병원 운영시간 조회 API를 요청하면 될 것이라고 판단했다.**

**병원 운영시간 데이터도 마찬가지로 클라이언트 단에서 빠르게 탐색, 색인할 수 있도록 Map 형태로 전달한다.**

**병원 검색에서 활용될 비즈니스 로직들을 컴포저블 함수로 묶어서 리팩토링하였다.**

**filteredByKeyword 함수 내에 있는 반응형 객체 구성 요소의 변경으로 인해 데이터 변경이 감지될 때,**
**병원 운영시간 조회 API를 요청하여 검색 결과에 포함된 병원들의 운영 시간 정보를 데이터 가져올 수 있도록 설계했다.**

**가장 먼저 FilterOptions.keyword 값을 기준으로 어떤 방식으로 병원을 필터링할 것인지 결정한다.**

**keyword가 진료 유형 단축어인지 판단 후, 해당 진료 유형으로 접수 신청이 가능한 병원들을 필터링한다.**

**keyword가 진료 과목 단축어인지 판단 후, 해당 진료 과목에 해당되는 병원들을 필터링한다.**

**keyword가 병원명이 포함되어있는지 판단 후, 해당하는 병원들을 필터링한다.**

**부가 옵션으로 FilterOptions.speciality 값을 받아 우선으로 필터링된 병원 목록 중, 다른 진료 과목도 포함되어 있는 병원들을 다시 필터링할 수 있게 한다.**

**다음은 키워드에 따른 필터링된 병원 리스트에서 정렬하기 위한 로직이다.**

**기본순으로 정렬 선택 시 (기본 옵션), 현재 시간 기준으로 운영 중인 병원을 우선 정렬한다.**

**가까운순으로 정렬 선택 시, 사용자 기기의 위치를 조회하여 현재 위치 기준으로 가장 가까운 병원들을 우선 정렬한다.**

**병원 검색 결과 페이지에서의 부가 기능으로 로그인되어있을 경우 즐겨찾기 토글 버튼이 보이고 추가/삭제 기능이 존재한다.**
**따라서 즐겨찾기 토글 버튼을 눌렀을 때, 로그인된 계정의 즐겨찾기 병원 목록을 재조회하도록 트리거로 설정했다.**
