---
title: "Legacy DB 테이블 정리"
date: "2025-08-31"
tags:
    - MySQL 8
---

하나의 메인 스키마에서 모든 서비스의 데이터를 담고 있는 상황에서
별도 스키마를 생성하여 결제 서비스와 관련된 데이터를 분리하려고 한다.
단, 결제 서비스 스키마에는 PG사와 연동, 통신 과정을 통해 생성되는 데이터만 담고,
외부에서 결제 서비스를 사용하려는 도메인에서는 결제 서비스 스키마의 테이블 간의 맵핑 테이블을 통해 데이터를 활용한다.

## Drop Table

- `tb_` 접두사로 생성된 결제 테이블 제거
- 뷰 테이블 제거

## Create Table

### 메인 스키마

- 각 도메인과 결제 서비스 간의 맵핑 테이블 생성
  - 최근 결제 상태 저장 테이블 생성
  - 이력 테이블 생성

### 결제 스키마

- 결제 이력 테이블 생성
- API 연동, 통신 로깅 테이블 생성

## 결제 요청 및 결과 데이터 관리 방식

결제 모듈은 오직 결제에 대한 순수한 데이터(청구서 ID, 결제 카드 정보, 승인번호, 승인일시, 결제 상태 등)를 저장하고 관리한다.

외부 도메인 API는 결제 모듈로부터 전달받은 결제 데이터와 진료 데이터를 연결, 맵핑시켜 저장하고 관리한다.

## 결제 수단 데이터 관리 방식

결제 모듈은 각 사용자들의 결제 수단에 대한 데이터를 저장하고 관리한다.

외부 도메인 API는 결제 모듈로부터 결제 수단 데이터를 가리키는 UUID 값을 전달받아 해당 UUID를 통해 결제 요청 및 결제 수단 조회를 수행한다.
