---
title: "2. ì–´ëŒ‘í„° íŒ¨í„´ ì„¤ê³„"
date: "2025-09-01"
tags:
    - Spring Boot 3.4.0
    - Java 21
    - MySQL 8
    - JPA
    - Design Pattern
    - Adapter Pattern
---

> **ë‹¤í˜•ì„±ì„ í™œìš©í•œ PGì‚¬ ì¶”ìƒí™”**
>
> Adapter Patternì„ ì ìš©í•˜ì—¬ ì—¬ëŸ¬ PGì‚¬ë¥¼ ìœ ì—°í•˜ê²Œ í†µí•©í•˜ê³ , ì‹ ê·œ PGì‚¬ ì¶”ê°€ ì‹œì—ë„ ê¸°ì¡´ ì½”ë“œ ë³€ê²½ ì—†ì´ í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°ë¥¼ ì„¤ê³„í•©ë‹ˆë‹¤.

---

## ğŸ¯ ì–´ëŒ‘í„° íŒ¨í„´ì´ í•„ìš”í•œ ì´ìœ 

### ë¬¸ì œ ìƒí™©

```java
// âŒ Bad: PGì‚¬ë§ˆë‹¤ ë‹¤ë¥¸ ì½”ë“œ ì‘ì„±
if (pgCompany.equals("TOSS")) {
  TossPaymentAPI tossAPI = new TossPaymentAPI();
  TossPaymentRequest request = new TossPaymentRequest();
  request.setOrderId(orderId);
  request.setAmount(amount);
  TossPaymentResponse response = tossAPI.requestPayment(request);
} else if (pgCompany.equals("NICE")) {
  NicePaymentAPI niceAPI = new NicePaymentAPI();
  NicePaymentDTO dto = new NicePaymentDTO();
  dto.setTid(orderId);
  dto.setAmt(amount);
  NicePaymentResult result = niceAPI.pay(dto);
}
// ... ë” ë§ì€ if-else
```

**ë¬¸ì œì :**
- âŒ PGì‚¬ ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • í•„ìš” (OCP ìœ„ë°˜)
- âŒ ê° PGì‚¬ë§ˆë‹¤ ë‹¤ë¥¸ API í˜•ì‹
- âŒ í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€ (Mock ê°ì²´ ìƒì„± ë³µì¡)
- âŒ ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ì¦ê°€

### í•´ê²° ë°©ë²•: Adapter Pattern

```java
// âœ… Good: í†µì¼ëœ ì¸í„°í˜ì´ìŠ¤ë¡œ ì¶”ìƒí™”
PaymentPort paymentPort = paymentPortFactory.create(pgCompany);
PaymentResponse response = paymentPort.payment(request);
```

**ì¥ì :**
- âœ… PGì‚¬ êµì²´/ì¶”ê°€ ì‹œ **ê¸°ì¡´ ì½”ë“œ ë³€ê²½ ì—†ìŒ** (OCP ì¤€ìˆ˜)
- âœ… í†µì¼ëœ ì¸í„°í˜ì´ìŠ¤ë¡œ ì¼ê´€ì„± ìœ ì§€
- âœ… í…ŒìŠ¤íŠ¸ ìš©ì´ (Mock Adapter ì‚¬ìš©)
- âœ… ê° PGì‚¬ êµ¬í˜„ì²´ëŠ” ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬

---

## ğŸ—ï¸ PaymentPort ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„

### í•µì‹¬ ì¸í„°í˜ì´ìŠ¤

```java
package com.payment.adapter;

/**
 * ê²°ì œ ì„œë¹„ìŠ¤ì˜ Port (í¬íŠ¸) ì¸í„°í˜ì´ìŠ¤
 * ëª¨ë“  PGì‚¬ AdapterëŠ” ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•¨
 */
public interface PaymentPort {

  /**
   * ê²°ì œ ìš”ì²­
   * @param payload ê²°ì œ ìš”ì²­ ë°ì´í„°
   * @param runnable ì„±ê³µ/ì‹¤íŒ¨ ì½œë°±
   * @return ê²°ì œ ì‘ë‹µ
   */
  PaymentResponse payment(
      PaymentRequest payload,
      PaymentAdapterRunnable<BaseResponse> runnable
  );

  /**
   * ê²°ì œ ì¡°íšŒ
   * @param payload ì¡°íšŒ ìš”ì²­ ë°ì´í„°
   * @return ì¡°íšŒ ê²°ê³¼
   */
  ReadResponse read(ReadRequest payload);

  /**
   * í™˜ë¶ˆ ìš”ì²­
   * @param payload í™˜ë¶ˆ ìš”ì²­ ë°ì´í„°
   * @param runnable ì„±ê³µ/ì‹¤íŒ¨ ì½œë°±
   * @return í™˜ë¶ˆ ì‘ë‹µ
   */
  RefundResponse refund(
      RefundRequest payload,
      PaymentAdapterRunnable<RefundResponse> runnable
  );

  /**
   * ê²°ì œ ì²­êµ¬ì„œ ì¹´ì¹´ì˜¤í†¡ ì „ì†¡
   * @param payload ì²­êµ¬ì„œ ì „ì†¡ ë°ì´í„°
   * @param runnable ì„±ê³µ/ì‹¤íŒ¨ ì½œë°±
   * @return ì „ì†¡ ê²°ê³¼
   */
  KakaoTalkResponse sendBill(
      TalkRequest payload,
      PaymentAdapterRunnable<KakaoTalkResponse> runnable
  );

  /**
   * ê²°ì œ ì²­êµ¬ì„œ íŒŒê¸°
   * @param payload íŒŒê¸° ìš”ì²­ ë°ì´í„°
   * @param successRunnable ì„±ê³µ ì½œë°±
   * @return íŒŒê¸° ê²°ê³¼
   */
  DestroyResponse destroy(
      DestroyRequest payload,
      PaymentAdapterRunnable<DestroyResponse> successRunnable
  );

  /**
   * ê²°ì œ ìš”ì²­ ê²°ê³¼ Callback ì²˜ë¦¬
   * @param payload PGì‚¬ë¡œë¶€í„° ë°›ì€ ì½œë°± ë°ì´í„°
   * @param hash ë³´ì•ˆ í•´ì‹œê°’
   * @return ì½œë°± ì²˜ë¦¬ ê²°ê³¼
   */
  default PaymentCallbackResponse callback(
      PaymentCallbackRequest payload,
      String hash
  ) {
    return null;
  }
}
```

---

## ğŸ“‹ DTO ì„¤ê³„

### ê³µí†µ Request/Response

```java
/**
 * ê²°ì œ ìš”ì²­ DTO (ê³µí†µ)
 */
@Getter
@Setter
@Builder
public class PaymentRequest {
  private String orderId;          // ì£¼ë¬¸ ID
  private Long amount;             // ê²°ì œ ê¸ˆì•¡
  private String currency;         // í†µí™” (KRW)
  private String billingKey;       // ë¹Œë§í‚¤ (ìë™ê²°ì œìš©)
  private String customerName;     // ê³ ê°ëª…
  private String customerEmail;    // ê³ ê° ì´ë©”ì¼
  private String customerPhone;    // ê³ ê° ì—°ë½ì²˜
  private String productName;      // ìƒí’ˆëª…
  private Map<String, Object> metadata; // ì¶”ê°€ ì •ë³´
}

/**
 * ê²°ì œ ì‘ë‹µ DTO (ê³µí†µ)
 */
@Getter
@Setter
@Builder
public class PaymentResponse {
  private String transactionId;    // íŠ¸ëœì­ì…˜ ID
  private String pgTransactionId;  // PGì‚¬ íŠ¸ëœì­ì…˜ ID
  private PaymentStatus status;    // ê²°ì œ ìƒíƒœ
  private String message;          // ì‘ë‹µ ë©”ì‹œì§€
  private Long paidAmount;         // ì‹¤ì œ ê²°ì œ ê¸ˆì•¡
  private LocalDateTime paidAt;    // ê²°ì œ ì™„ë£Œ ì‹œê°„

  // PGì‚¬ ì›ë³¸ ë°ì´í„° (ë””ë²„ê¹…ìš©)
  private Object rawData;
}

/**
 * ê²°ì œ ìƒíƒœ Enum
 */
public enum PaymentStatus {
  PENDING,    // ëŒ€ê¸° ì¤‘
  SUCCESS,    // ì„±ê³µ
  FAILED,     // ì‹¤íŒ¨
  CANCELLED,  // ì·¨ì†Œë¨
  REFUNDED    // í™˜ë¶ˆë¨
}
```

---

## ğŸ”§ Runnable íŒ¨í„´ ì¸í„°í˜ì´ìŠ¤

```java
/**
 * ê²°ì œ ì²˜ë¦¬ ì„±ê³µ/ì‹¤íŒ¨ ì‹œ ì‹¤í–‰í•  ì½œë°± ì¸í„°í˜ì´ìŠ¤
 * @param <T> ì‘ë‹µ íƒ€ì…
 */
@FunctionalInterface
public interface PaymentAdapterRunnable<T> {

  /**
   * ì½œë°± ì‹¤í–‰
   * @param response PGì‚¬ ì‘ë‹µ
   * @param exception ì˜ˆì™¸ (ì—†ìœ¼ë©´ null)
   */
  void run(T response, Exception exception);
}
```

### ì‚¬ìš© ì˜ˆì‹œ

```java
paymentPort.payment(request, (response, exception) -> {
  if (exception != null) {
    // ì‹¤íŒ¨ ì²˜ë¦¬
    log.error("ê²°ì œ ì‹¤íŒ¨: {}", exception.getMessage());
    orderService.markAsFailed(orderId);
  } else {
    // ì„±ê³µ ì²˜ë¦¬
    log.info("ê²°ì œ ì„±ê³µ: {}", response.getTransactionId());
    orderService.markAsCompleted(orderId);
  }
});
```

---

## ğŸ­ Factory Patternìœ¼ë¡œ Adapter ì„ íƒ

### PaymentPortFactory

```java
@Component
public class PaymentPortFactory {

  private final Map<String, PaymentPort> adapterMap;

  public PaymentPortFactory(List<PaymentPort> adapters) {
    this.adapterMap = adapters.stream()
        .collect(Collectors.toMap(
            adapter -> adapter.getClass().getSimpleName()
                .replace("Adapter", "")
                .toUpperCase(),
            adapter -> adapter
        ));
  }

  /**
   * PGì‚¬ ì½”ë“œë¡œ ì ì ˆí•œ Adapter ë°˜í™˜
   * @param pgCompany PGì‚¬ ì½”ë“œ (TOSS, NICE, etc.)
   * @return PaymentPort êµ¬í˜„ì²´
   */
  public PaymentPort create(String pgCompany) {
    PaymentPort adapter = adapterMap.get(pgCompany.toUpperCase());

    if (adapter == null) {
      throw new IllegalArgumentException(
          "ì§€ì›í•˜ì§€ ì•ŠëŠ” PGì‚¬ì…ë‹ˆë‹¤: " + pgCompany
      );
    }

    return adapter;
  }
}
```

---

## ğŸ¨ UML ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         <<interface>>               â”‚
â”‚         PaymentPort                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + payment()                         â”‚
â”‚ + read()                            â”‚
â”‚ + refund()                          â”‚
â”‚ + sendBill()                        â”‚
â”‚ + destroy()                         â”‚
â”‚ + callback()                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–²         â–²         â–²
            â”‚         â”‚         â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â” â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â” â”Œâ”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Toss      â”‚ â”‚ Nice    â”‚ â”‚ Kakao    â”‚
   â”‚ Adapter   â”‚ â”‚ Adapter â”‚ â”‚ Adapter  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ ì„¤ê³„ ì›ì¹™

### 1ï¸âƒ£ ê°œë°©-íì‡„ ì›ì¹™ (OCP)

> í™•ì¥ì—ëŠ” ì—´ë ¤ìˆê³ , ìˆ˜ì •ì—ëŠ” ë‹«í˜€ìˆì–´ì•¼ í•œë‹¤.

```java
// âœ… ì‹ ê·œ PGì‚¬ ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ìŒ
@Component
public class NewPGAdapter implements PaymentPort {
  @Override
  public PaymentResponse payment(PaymentRequest payload, ...) {
    // ì‹ ê·œ PGì‚¬ êµ¬í˜„
  }
}
```

### 2ï¸âƒ£ ì˜ì¡´ì„± ì—­ì „ ì›ì¹™ (DIP)

> ê³ ìˆ˜ì¤€ ëª¨ë“ˆì€ ì €ìˆ˜ì¤€ ëª¨ë“ˆì— ì˜ì¡´í•˜ì§€ ì•Šê³ , ì¶”ìƒí™”ì— ì˜ì¡´í•´ì•¼ í•œë‹¤.

```java
// âœ… ServiceëŠ” êµ¬ì²´ì ì¸ Adapterê°€ ì•„ë‹Œ PaymentPortì— ì˜ì¡´
@Service
public class PaymentService {

  private final PaymentPortFactory factory;

  public void processPayment(String pgCompany, PaymentRequest request) {
    PaymentPort port = factory.create(pgCompany);  // ì¶”ìƒí™”ì— ì˜ì¡´
    port.payment(request, ...);
  }
}
```

### 3ï¸âƒ£ ë‹¨ì¼ ì±…ì„ ì›ì¹™ (SRP)

> ê° AdapterëŠ” í•˜ë‚˜ì˜ PGì‚¬ ì—°ë™ë§Œ ë‹´ë‹¹

```java
// âœ… TossAdapterëŠ” Toss PGì‚¬ë§Œ ë‹´ë‹¹
@Component
public class TossAdapter implements PaymentPort {
  // Toss API ì—°ë™ ë¡œì§ë§Œ í¬í•¨
}
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ

### Mock Adapter í™œìš©

```java
/**
 * í…ŒìŠ¤íŠ¸ìš© Mock Adapter
 */
public class MockPaymentAdapter implements PaymentPort {

  @Override
  public PaymentResponse payment(PaymentRequest payload, ...) {
    // ì¦‰ì‹œ ì„±ê³µ ì‘ë‹µ ë°˜í™˜
    return PaymentResponse.builder()
        .transactionId("TEST_" + UUID.randomUUID())
        .status(PaymentStatus.SUCCESS)
        .paidAmount(payload.getAmount())
        .build();
  }

  // ë‹¤ë¥¸ ë©”ì„œë“œë„ ê°„ë‹¨íˆ êµ¬í˜„...
}
```

### í…ŒìŠ¤íŠ¸ ì½”ë“œ

```java
@Test
void ê²°ì œ_ì„±ê³µ_í…ŒìŠ¤íŠ¸() {
  // Given
  PaymentPort mockAdapter = new MockPaymentAdapter();
  PaymentRequest request = PaymentRequest.builder()
      .orderId("ORDER123")
      .amount(10000L)
      .build();

  // When
  PaymentResponse response = mockAdapter.payment(request, null);

  // Then
  assertThat(response.getStatus()).isEqualTo(PaymentStatus.SUCCESS);
  assertThat(response.getPaidAmount()).isEqualTo(10000L);
}
```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] PaymentPort ì¸í„°í˜ì´ìŠ¤ ì •ì˜ ì™„ë£Œ
- [ ] ê³µí†µ DTO ì„¤ê³„ ì™„ë£Œ
- [ ] PaymentPortFactory êµ¬í˜„ ì™„ë£Œ
- [ ] Runnable íŒ¨í„´ ì¸í„°í˜ì´ìŠ¤ ì •ì˜ ì™„ë£Œ
- [ ] í…ŒìŠ¤íŠ¸ìš© Mock Adapter ì¤€ë¹„ ì™„ë£Œ

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

[3. ì–´ëŒ‘í„° êµ¬í˜„ì²´ ì„¤ê³„](/Back-End/ê²°ì œ-ì„œë¹„ìŠ¤-MSA-ì•„í‚¤í…ì³-ì „í™˜/3-ì–´ëŒ‘í„°-êµ¬í˜„ì²´-ì„¤ê³„)ë¡œ ì´ë™í•˜ì—¬ ì‹¤ì œ PGì‚¬ ì—°ë™ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

**ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„ ì™„ë£Œ! ì´ì œ êµ¬í˜„ìœ¼ë¡œ!** ğŸ’ª