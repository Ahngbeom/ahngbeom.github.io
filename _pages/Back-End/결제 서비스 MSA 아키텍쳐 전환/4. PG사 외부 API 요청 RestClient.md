---
title: "4. PGì‚¬ ì™¸ë¶€ API ìš”ì²­ RestClient"
date: "2025-09-03"
tags:
    - Spring Boot 3.4.0
    - Java 21
    - RestClient
    - HTTP Client
    - Interface-based Client
    - Spring Framework 6.1
---

> **Spring Framework 6.1ì˜ ì„ ì–¸ì  HTTP í´ë¼ì´ì–¸íŠ¸**
>
> `@HttpExchange` ì–´ë…¸í…Œì´ì…˜ì„ í™œìš©í•œ ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ RestClient ì„¤ê³„ì™€ PGì‚¬ API í†µì‹  êµ¬í˜„ì„ ë‹¤ë£¹ë‹ˆë‹¤.

---

## ğŸ¯ RestClient ë„ì… ë°°ê²½

### ê¸°ì¡´ ë°©ì‹ì˜ ë¬¸ì œì 

```java
// âŒ Bad: RestTemplate (êµ¬ì‹)
@Service
public class OldPaymentClient {

  private final RestTemplate restTemplate;

  public PaymentResponse payment(PaymentRequest request) {
    HttpHeaders headers = new HttpHeaders();
    headers.setContentType(MediaType.APPLICATION_JSON);
    headers.set("Authorization", "Bearer " + apiKey);

    HttpEntity<PaymentRequest> entity = new HttpEntity<>(request, headers);

    return restTemplate.postForObject(
        pgApiUrl + "/v1/payments",
        entity,
        PaymentResponse.class
    );
  }

  // ê° ë©”ì„œë“œë§ˆë‹¤ ë°˜ë³µë˜ëŠ” ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ...
}
```

**ë¬¸ì œì :**

- âŒ ë§¤ë²ˆ HttpHeaders ì„¤ì • í•„ìš”
- âŒ ì—ëŸ¬ í•¸ë“¤ë§ì´ ê° ë©”ì„œë“œë§ˆë‹¤ ì¤‘ë³µ
- âŒ í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë ¤ìš´ êµ¬ì¡°
- âŒ íƒ€ì… ì•ˆì „ì„± ë¶€ì¡±

### Spring 6.1 RestClientì˜ ì¥ì 

```java
// âœ… Good: Interface ê¸°ë°˜ RestClient
@Component
@HttpExchange("/v1")
public interface TossPgClient {

  @PostExchange("/payments")
  TossPaymentResponse payment(@RequestBody TossPaymentRequest request);

  @GetExchange("/payments/{paymentKey}")
  TossReadResponse read(@PathVariable String paymentKey);

  @PostExchange("/payments/{paymentKey}/cancel")
  TossRefundResponse refund(
      @PathVariable String paymentKey,
      @RequestBody TossRefundRequest request
  );
}
```

**ì¥ì :**

- âœ… **ì„ ì–¸ì  API ì •ì˜**: ì¸í„°í˜ì´ìŠ¤ë§Œìœ¼ë¡œ HTTP í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„
- âœ… **ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì œê±°**: ê³µí†µ ì„¤ì • ì¤‘ì•™í™”
- âœ… **íƒ€ì… ì•ˆì „ì„±**: ì»´íŒŒì¼ íƒ€ì„ íƒ€ì… ì²´í¬
- âœ… **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**: Mock ì¸í„°í˜ì´ìŠ¤ë¡œ ì‰½ê²Œ í…ŒìŠ¤íŠ¸

---

## ğŸ—ï¸ TossPgClient ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„

### ì „ì²´ ì¸í„°í˜ì´ìŠ¤ êµ¬ì¡°

```java
package com.payment.adapter.toss;

import org.springframework.stereotype.Component;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.service.annotation.HttpExchange;
import org.springframework.web.service.annotation.PostExchange;
import org.springframework.web.service.annotation.GetExchange;

/**
 * Toss PGì‚¬ API í†µì‹  ì¸í„°í˜ì´ìŠ¤
 * Spring Framework 6.1+ @HttpExchange ì‚¬ìš©
 */
@Component
@HttpExchange("/v1")
public interface TossPgClient {

  /**
   * ì¦‰ì‹œ ê²°ì œ ìš”ì²­
   * POST /v1/payments
   */
  @PostExchange("/payments")
  TossPaymentResponse payment(@RequestBody TossPaymentRequest request);

  /**
   * ë¹Œë§í‚¤ ë°œê¸‰ (ìë™ê²°ì œìš©)
   * POST /v1/billing/authorizations/issue
   */
  @PostExchange("/billing/authorizations/issue")
  TossBillingKeyResponse issueBillingKey(@RequestBody TossBillingKeyRequest request);

  /**
   * ë¹Œë§í‚¤ë¡œ ê²°ì œ ìš”ì²­
   * POST /v1/billing/{billingKey}
   */
  @PostExchange("/billing/{billingKey}")
  TossPaymentResponse paymentWithBillingKey(
      @PathVariable String billingKey,
      @RequestBody TossPaymentRequest request
  );

  /**
   * ì¹´ì¹´ì˜¤í†¡ ì²­êµ¬ì„œ ë°œì†¡
   * POST /v1/billing/kakao
   */
  @PostExchange("/billing/kakao")
  TossBillResponse sendBill(@RequestBody TossBillRequest request);

  /**
   * ê²°ì œ ì •ë³´ ì¡°íšŒ
   * GET /v1/payments/{paymentKey}
   */
  @GetExchange("/payments/{paymentKey}")
  TossReadResponse read(@PathVariable String paymentKey);

  /**
   * ì£¼ë¬¸ IDë¡œ ê²°ì œ ì¡°íšŒ
   * GET /v1/payments/orders/{orderId}
   */
  @GetExchange("/payments/orders/{orderId}")
  TossReadResponse readByOrderId(@PathVariable String orderId);

  /**
   * ê²°ì œ ì·¨ì†Œ/í™˜ë¶ˆ
   * POST /v1/payments/{paymentKey}/cancel
   */
  @PostExchange("/payments/{paymentKey}/cancel")
  TossRefundResponse refund(
      @PathVariable String paymentKey,
      @RequestBody TossRefundRequest request
  );

  /**
   * ì²­êµ¬ì„œ íŒŒê¸°
   * DELETE /v1/billing/{billKey}
   */
  @HttpExchange(method = "DELETE", value = "/billing/{billKey}")
  TossDestroyResponse destroy(@PathVariable String billKey);
}
```

### ì£¼ìš” ì–´ë…¸í…Œì´ì…˜ ì„¤ëª…

#### `@Component`

- Spring Beanìœ¼ë¡œ ë“±ë¡
- HttpServiceProxyFactoryê°€ í”„ë¡ì‹œ ìƒì„± ì‹œ ìë™ ê°ì§€

#### `@HttpExchange("/v1")`

- í´ë˜ìŠ¤ ë ˆë²¨: ëª¨ë“  ë©”ì„œë“œì˜ **Base Path** ì§€ì •
- ë©”ì„œë“œ ë ˆë²¨: ê°œë³„ ì—”ë“œí¬ì¸íŠ¸ ê²½ë¡œ ì§€ì •

#### `@PostExchange`, `@GetExchange`

- HTTP ë©”ì„œë“œë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•˜ëŠ” ê°„í¸ ì–´ë…¸í…Œì´ì…˜
- `@HttpExchange(method = "POST")` ì˜ ì¶•ì•½í˜•

#### `@RequestBody`, `@PathVariable`

- Spring MVCì™€ ë™ì¼í•œ ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš©
- ìš”ì²­ ë³¸ë¬¸ê³¼ ê²½ë¡œ ë³€ìˆ˜ ìë™ ë§¤í•‘

---

## âš™ï¸ RestClient ì„¤ì •

### RestClientConfig í´ë˜ìŠ¤

```java
package com.payment.config;

import com.payment.adapter.toss.TossPgClient;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpStatusCode;
import org.springframework.http.MediaType;
import org.springframework.web.client.RestClient;
import org.springframework.web.client.support.RestClientAdapter;
import org.springframework.web.service.invoker.HttpServiceProxyFactory;

import java.nio.charset.StandardCharsets;
import java.time.Duration;
import java.util.Base64;

import static org.springframework.http.HttpHeaders.*;

/**
 * RestClient ì„¤ì • í´ë˜ìŠ¤
 */
@Slf4j
@Configuration
public class RestClientConfig {

  @Value("${payment.toss.api-url}")
  private String tossApiUrl;

  @Value("${payment.toss.api-key}")
  private String tossApiKey;

  @Value("${payment.toss.secret-key}")
  private String tossSecretKey;

  /**
   * Toss PG Client ë¹ˆ ìƒì„±
   */
  @Bean
  public TossPgClient tossPgClient() {
    RestClient restClient = tossRestClientBuilder()
        .baseUrl(tossApiUrl)
        .build();

    RestClientAdapter adapter = RestClientAdapter.create(restClient);

    HttpServiceProxyFactory factory = HttpServiceProxyFactory
        .builderFor(adapter)
        .build();

    return factory.createClient(TossPgClient.class);
  }

  /**
   * Toss ì „ìš© RestClient.Builder
   */
  @Bean
  public RestClient.Builder tossRestClientBuilder() {
    // Basic Auth ì¸ì¦ í—¤ë” ìƒì„±
    String auth = tossSecretKey + ":";
    String encodedAuth = Base64.getEncoder()
        .encodeToString(auth.getBytes(StandardCharsets.UTF_8));

    return RestClient.builder()
        // ê¸°ë³¸ í—¤ë” ì„¤ì •
        .defaultHeader(CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE)
        .defaultHeader(ACCEPT, MediaType.APPLICATION_JSON_VALUE)
        .defaultHeader(AUTHORIZATION, "Basic " + encodedAuth)

        // íƒ€ì„ì•„ì›ƒ ì„¤ì •
        .requestFactory(clientHttpRequestFactory())

        // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬
        .defaultStatusHandler(
            HttpStatusCode::is4xxClientError,
            (request, response) -> {
              log.error("Toss API 4xx ì—ëŸ¬ ë°œìƒ");
              log.error("Request: {} {}", request.getMethod(), request.getURI());
              log.error("Response: {} {}", response.getStatusCode(), response.getStatusText());
              log.error("Response Body: {}", new String(response.getBody().readAllBytes()));
            }
        )
        .defaultStatusHandler(
            HttpStatusCode::is5xxServerError,
            (request, response) -> {
              log.error("Toss API 5xx ì—ëŸ¬ ë°œìƒ");
              log.error("Request: {} {}", request.getMethod(), request.getURI());
              log.error("Response: {} {}", response.getStatusCode(), response.getStatusText());
            }
        );
  }

  /**
   * HTTP íƒ€ì„ì•„ì›ƒ ì„¤ì •ì„ ìœ„í•œ RequestFactory
   */
  @Bean
  public ClientHttpRequestFactory clientHttpRequestFactory() {
    SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory();

    // ì—°ê²° íƒ€ì„ì•„ì›ƒ: 5ì´ˆ
    factory.setConnectTimeout(Duration.ofSeconds(5));

    // ì½ê¸° íƒ€ì„ì•„ì›ƒ: 30ì´ˆ (ê²°ì œ APIëŠ” ì‘ë‹µì´ ëŠë¦´ ìˆ˜ ìˆìŒ)
    factory.setReadTimeout(Duration.ofSeconds(30));

    return factory;
  }
}
```

### ì„¤ì • ìƒì„¸ ì„¤ëª…

#### 1. Base URL ì„¤ì •

```java
.baseUrl(tossApiUrl)
```

- ëª¨ë“  ìš”ì²­ì˜ ê¸°ë³¸ URL ì„¤ì •
- `application.yml`ì—ì„œ í™˜ê²½ë³„ë¡œ ê´€ë¦¬

```yaml
# application.yml
payment:
  toss:
    api-url: https://api.tosspayments.com
    api-key: ${TOSS_API_KEY}
    secret-key: ${TOSS_SECRET_KEY}
```

#### 2. Basic Auth ì¸ì¦

```java
String auth = tossSecretKey + ":";
String encodedAuth = Base64.getEncoder()
    .encodeToString(auth.getBytes(StandardCharsets.UTF_8));

.defaultHeader(AUTHORIZATION, "Basic " + encodedAuth)
```

- Toss APIëŠ” **Basic Authentication** ë°©ì‹ ì‚¬ìš©
- Secret Keyë¥¼ Base64 ì¸ì½”ë”©í•˜ì—¬ Authorization í—¤ë”ì— í¬í•¨

#### 3. ê¸°ë³¸ í—¤ë” ì„¤ì •

```java
.defaultHeader(CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE)
.defaultHeader(ACCEPT, MediaType.APPLICATION_JSON_VALUE)
```

- ëª¨ë“  ìš”ì²­ì— ìë™ìœ¼ë¡œ í¬í•¨ë  í—¤ë” ì„¤ì •
- JSON ê¸°ë°˜ API í†µì‹ ì„ ìœ„í•œ Content-Type ì§€ì •

#### 4. íƒ€ì„ì•„ì›ƒ ì„¤ì •

```java
factory.setConnectTimeout(Duration.ofSeconds(5));   // ì—°ê²° íƒ€ì„ì•„ì›ƒ
factory.setReadTimeout(Duration.ofSeconds(30));     // ì½ê¸° íƒ€ì„ì•„ì›ƒ
```

- **ì—°ê²° íƒ€ì„ì•„ì›ƒ**: ì„œë²„ì— ì—°ê²° ì‹œë„í•˜ëŠ” ìµœëŒ€ ì‹œê°„
- **ì½ê¸° íƒ€ì„ì•„ì›ƒ**: ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ìµœëŒ€ ì‹œê°„
- ê²°ì œ APIëŠ” ìŠ¹ì¸ ê³¼ì •ì´ ìˆì–´ 30ì´ˆë¡œ ì„¤ì •

#### 5. ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬

```java
.defaultStatusHandler(
    HttpStatusCode::is4xxClientError,
    (request, response) -> {
      // 4xx ì—ëŸ¬ ì²˜ë¦¬
      log.error("Request: {} {}", request.getMethod(), request.getURI());
      log.error("Response: {}", response.getStatusCode());
    }
)
```

- **4xx ì—ëŸ¬**: í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ì˜¤ë¥˜ (ì˜ëª»ëœ íŒŒë¼ë¯¸í„° ë“±)
- **5xx ì—ëŸ¬**: ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜
- ìƒì„¸í•œ ë¡œê·¸ë¥¼ ë‚¨ê²¨ ë””ë²„ê¹… ìš©ì´

---

## ğŸ”„ HttpServiceProxyFactory

### ë™ì  í”„ë¡ì‹œ ìƒì„±

```java
HttpServiceProxyFactory factory = HttpServiceProxyFactory
    .builderFor(RestClientAdapter.create(restClient))
    .build();

return factory.createClient(TossPgClient.class);
```

**ë™ì‘ ì›ë¦¬:**

1. `RestClientAdapter`: RestClientë¥¼ HttpExchange ì–´ëŒ‘í„°ë¡œ ë³€í™˜
2. `HttpServiceProxyFactory`: ì¸í„°í˜ì´ìŠ¤ ë©”ì„œë“œë¥¼ HTTP ìš”ì²­ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í”„ë¡ì‹œ ìƒì„±
3. `createClient()`: ëŸ°íƒ€ì„ì— ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ ìƒì„±

### í”„ë¡ì‹œê°€ í•˜ëŠ” ì¼

```java
// ê°œë°œìê°€ ì‘ì„±í•œ ì½”ë“œ
TossPaymentResponse response = tossPgClient.payment(request);

// í”„ë¡ì‹œê°€ ì‹¤ì œë¡œ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…
// 1. @PostExchange ì–´ë…¸í…Œì´ì…˜ ì½ê¸°
// 2. HTTP POST ìš”ì²­ ìƒì„±
// 3. Base URL + "/v1/payments" ì¡°í•©
// 4. @RequestBody ì–´ë…¸í…Œì´ì…˜ì˜ request ê°ì²´ë¥¼ JSONìœ¼ë¡œ ì§ë ¬í™”
// 5. ê¸°ë³¸ í—¤ë” ì¶”ê°€ (Content-Type, Authorization ë“±)
// 6. RestClientë¡œ ì‹¤ì œ HTTP ìš”ì²­ ì „ì†¡
// 7. ì‘ë‹µì„ TossPaymentResponse íƒ€ì…ìœ¼ë¡œ ì—­ì§ë ¬í™”
// 8. ë°˜í™˜
```

---

## ğŸ“¦ DTO ì„¤ê³„

### Request DTO ì˜ˆì‹œ

```java
/**
 * Toss ê²°ì œ ìš”ì²­ DTO
 */
@Getter
@Builder
public class TossPaymentRequest {

  @JsonProperty("orderId")
  private String orderId;

  @JsonProperty("amount")
  private Long amount;

  @JsonProperty("orderName")
  private String orderName;

  @JsonProperty("customerName")
  private String customerName;

  @JsonProperty("customerEmail")
  private String customerEmail;

  @JsonProperty("customerMobilePhone")
  private String customerMobilePhone;

  /**
   * ê³µí†µ PaymentRequestì—ì„œ Toss ì „ìš© DTOë¡œ ë³€í™˜
   */
  public static TossPaymentRequest from(PaymentRequest common) {
    return TossPaymentRequest.builder()
        .orderId(common.getOrderId())
        .amount(common.getAmount())
        .orderName(common.getProductName())
        .customerName(common.getCustomerName())
        .customerEmail(common.getCustomerEmail())
        .customerMobilePhone(common.getCustomerPhone())
        .build();
  }
}
```

### Response DTO ì˜ˆì‹œ

```java
/**
 * Toss ê²°ì œ ì‘ë‹µ DTO
 */
@Getter
@Setter
@JsonIgnoreProperties(ignoreUnknown = true)
public class TossPaymentResponse {

  @JsonProperty("paymentKey")
  private String paymentKey;

  @JsonProperty("orderId")
  private String orderId;

  @JsonProperty("status")
  private String status;

  @JsonProperty("totalAmount")
  private Long totalAmount;

  @JsonProperty("approvedAt")
  private String approvedAt;

  @JsonProperty("method")
  private String method;

  @JsonProperty("card")
  private TossCardInfo card;

  // ì—ëŸ¬ ì‘ë‹µ í•„ë“œ
  @JsonProperty("code")
  private String errorCode;

  @JsonProperty("message")
  private String errorMessage;

  /**
   * ì„±ê³µ ì—¬ë¶€ íŒë‹¨
   */
  public boolean isSuccess() {
    return errorCode == null && "DONE".equals(status);
  }
}

/**
 * Toss ì¹´ë“œ ì •ë³´
 */
@Getter
@Setter
@JsonIgnoreProperties(ignoreUnknown = true)
public class TossCardInfo {

  @JsonProperty("company")
  private String company;

  @JsonProperty("number")
  private String number;  // ë§ˆìŠ¤í‚¹ëœ ì¹´ë“œë²ˆí˜¸

  @JsonProperty("installmentPlanMonths")
  private Integer installmentPlanMonths;

  @JsonProperty("isInterestFree")
  private Boolean isInterestFree;
}
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ

### Mock ì¸í„°í˜ì´ìŠ¤ í™œìš©

```java
@SpringBootTest
class TossAdapterTest {

  @MockBean
  private TossPgClient tossPgClient;

  @Autowired
  private TossAdapter tossAdapter;

  @Test
  void ê²°ì œ_ì„±ê³µ_í…ŒìŠ¤íŠ¸() {
    // Given
    TossPaymentRequest request = TossPaymentRequest.builder()
        .orderId("ORDER_123")
        .amount(10000L)
        .build();

    TossPaymentResponse mockResponse = new TossPaymentResponse();
    mockResponse.setPaymentKey("TOSS_PAY_KEY_123");
    mockResponse.setStatus("DONE");
    mockResponse.setTotalAmount(10000L);

    // Mock ë™ì‘ ì •ì˜
    when(tossPgClient.payment(any())).thenReturn(mockResponse);

    // When
    PaymentResponse response = tossAdapter.payment(
        PaymentRequest.builder().orderId("ORDER_123").amount(10000L).build(),
        PaymentAdapterRunnable.paymentRunnable(
            uuid -> {},
            (uuid, res) -> {},
            (uuid, error) -> {}
        )
    );

    // Then
    assertThat(response.getStatus()).isEqualTo(PaymentStatus.SUCCESS);
    assertThat(response.getPgTransactionId()).isEqualTo("TOSS_PAY_KEY_123");
  }

  @Test
  void PGì‚¬_API_ì—ëŸ¬_í…ŒìŠ¤íŠ¸() {
    // Given
    when(tossPgClient.payment(any()))
        .thenThrow(new RestClientException("Connection timeout"));

    // When & Then
    assertThatThrownBy(() ->
        tossAdapter.payment(
            PaymentRequest.builder().build(),
            PaymentAdapterRunnable.paymentRunnable(
                uuid -> {},
                (uuid, res) -> {},
                (uuid, error) -> {}
            )
        )
    ).isInstanceOf(PaymentException.class)
     .hasMessageContaining("ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨");
  }
}
```

### WireMockì„ í™œìš©í•œ í†µí•© í…ŒìŠ¤íŠ¸

```java
@SpringBootTest
@AutoConfigureWireMock(port = 0)
class TossPgClientIntegrationTest {

  @Autowired
  private TossPgClient tossPgClient;

  @Test
  void Toss_ê²°ì œ_API_í†µí•©_í…ŒìŠ¤íŠ¸() {
    // WireMock ì‘ë‹µ ì„¤ì •
    stubFor(post(urlEqualTo("/v1/payments"))
        .willReturn(aResponse()
            .withStatus(200)
            .withHeader("Content-Type", "application/json")
            .withBody("""
                {
                  "paymentKey": "MOCK_PAYMENT_KEY",
                  "orderId": "ORDER_123",
                  "status": "DONE",
                  "totalAmount": 10000,
                  "approvedAt": "2025-09-30T12:00:00"
                }
                """)));

    // When
    TossPaymentResponse response = tossPgClient.payment(
        TossPaymentRequest.builder()
            .orderId("ORDER_123")
            .amount(10000L)
            .build()
    );

    // Then
    assertThat(response.getPaymentKey()).isEqualTo("MOCK_PAYMENT_KEY");
    assertThat(response.getStatus()).isEqualTo("DONE");
  }
}
```

---

## ğŸ”§ ì‹¤ì „ í™œìš© íŒ

### 1. ì—¬ëŸ¬ PGì‚¬ ì§€ì› ì‹œ

```java
@Bean
public TossPgClient tossPgClient() {
  return createPgClient(TossPgClient.class, tossApiUrl, tossSecretKey);
}

@Bean
public NicePgClient nicePgClient() {
  return createPgClient(NicePgClient.class, niceApiUrl, niceSecretKey);
}

private <T> T createPgClient(Class<T> clientClass, String baseUrl, String secretKey) {
  RestClient restClient = RestClient.builder()
      .baseUrl(baseUrl)
      .defaultHeader(AUTHORIZATION, "Bearer " + secretKey)
      // ... ê³µí†µ ì„¤ì •
      .build();

  return HttpServiceProxyFactory
      .builderFor(RestClientAdapter.create(restClient))
      .build()
      .createClient(clientClass);
}
```

### 2. ìš”ì²­/ì‘ë‹µ ë¡œê¹…

```java
@Bean
public RestClient.Builder loggingRestClientBuilder() {
  return RestClient.builder()
      .requestInterceptor((request, body, execution) -> {
        log.info("Request: {} {}", request.getMethod(), request.getURI());
        log.debug("Request Body: {}", new String(body, StandardCharsets.UTF_8));

        ClientHttpResponse response = execution.execute(request, body);

        log.info("Response: {}", response.getStatusCode());
        return response;
      });
}
```

### 3. Retry ë¡œì§ ì¶”ê°€

```java
@Retryable(
    value = {RestClientException.class},
    maxAttempts = 3,
    backoff = @Backoff(delay = 1000, multiplier = 2)
)
@Bean
public TossPgClient tossPgClientWithRetry() {
  return tossPgClient();
}
```

---

## ğŸ’¡ RestTemplateê³¼ ë¹„êµ

| í•­ëª© | RestTemplate | RestClient (Spring 6.1+) |
|------|--------------|--------------------------|
| ì„¤ê³„ ë°©ì‹ | ëª…ë ¹í˜• | ì„ ì–¸í˜• |
| ì½”ë“œ ê°„ê²°ì„± | âŒ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ë§ìŒ | âœ… ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜ |
| íƒ€ì… ì•ˆì „ì„± | âš ï¸ ëŸ°íƒ€ì„ ìºìŠ¤íŒ… | âœ… ì»´íŒŒì¼ íƒ€ì„ ì²´í¬ |
| í…ŒìŠ¤íŠ¸ ìš©ì´ì„± | âš ï¸ MockRestServiceServer í•„ìš” | âœ… @MockBeanìœ¼ë¡œ ê°„ë‹¨íˆ |
| ìœ ì§€ë³´ìˆ˜ì„± | âŒ ê° ë©”ì„œë“œë§ˆë‹¤ ì¤‘ë³µ ì½”ë“œ | âœ… ì¤‘ì•™í™”ëœ ì„¤ì • |
| ì„±ëŠ¥ | ë™ì¼ | ë™ì¼ |
| ê¶Œì¥ ì—¬ë¶€ | ğŸš« Deprecated ì˜ˆì • | âœ… ê³µì‹ ê¶Œì¥ |

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] TossPgClient ì¸í„°í˜ì´ìŠ¤ ì •ì˜ ì™„ë£Œ
- [ ] RestClientConfig ì„¤ì • ì™„ë£Œ
- [ ] Basic Auth ì¸ì¦ êµ¬í˜„
- [ ] íƒ€ì„ì•„ì›ƒ ì„¤ì • ì™„ë£Œ
- [ ] ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬ êµ¬í˜„
- [ ] Request/Response DTO ì •ì˜
- [ ] í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
- [ ] WireMock í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

[5. Runnable íŒ¨í„´ êµ¬í˜„](/Back-End/ê²°ì œ-ì„œë¹„ìŠ¤-MSA-ì•„í‚¤í…ì³-ì „í™˜/5-Runnable-íŒ¨í„´-êµ¬í˜„)ë¡œ ì´ë™í•˜ì—¬ ê²°ì œ ì²˜ë¦¬ ì½œë°± ë©”ì»¤ë‹ˆì¦˜ì„ í™•ì¸í•©ë‹ˆë‹¤.

**HTTP í´ë¼ì´ì–¸íŠ¸ ì„¤ì • ì™„ë£Œ! ì´ì œ ì½œë°± íŒ¨í„´ìœ¼ë¡œ!** ğŸ’ª