---
title: "6. ì¸í„°í˜ì´ìŠ¤ ì¶”ìƒí™”"
date: "2025-09-05"
tags:
    - Spring Boot 3.4.0
    - Java 21
    - Interface
    - Port and Adapter Pattern
    - Clean Architecture
    - MSA
---

> **ìµœì¢… ì•„í‚¤í…ì²˜ ì •ë¦¬ ë° í™•ì¥ ì „ëµ**
>
> PaymentPort ì¸í„°í˜ì´ìŠ¤ ì¶”ìƒí™”ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì „ì²´ ê²°ì œ ì„œë¹„ìŠ¤ì˜ ìµœì¢… ì•„í‚¤í…ì²˜ êµ¬ì¡°ì™€ í–¥í›„ í™•ì¥ í¬ì¸íŠ¸ë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤.

---

## ğŸ¯ ì¸í„°í˜ì´ìŠ¤ ì¶”ìƒí™”ì˜ ëª©ì 

### Port and Adapter íŒ¨í„´ (Hexagonal Architecture)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Domain Layer                        â”‚
â”‚  (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ - PGì‚¬ì— ë…ë¦½ì )                         â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚      <<interface>>                        â”‚         â”‚
â”‚  â”‚      PaymentPort                          â”‚         â”‚
â”‚  â”‚  - payment()                              â”‚         â”‚
â”‚  â”‚  - read()                                 â”‚         â”‚
â”‚  â”‚  - refund()                               â”‚         â”‚
â”‚  â”‚  - sendBill()                             â”‚         â”‚
â”‚  â”‚  - destroy()                              â”‚         â”‚
â”‚  â”‚  - callback()                             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                      â–²                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TossAdapter   â”‚           â”‚  NiceAdapter    â”‚
â”‚  (êµ¬í˜„ì²´)       â”‚           â”‚  (êµ¬í˜„ì²´)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                              â”‚
        â–¼                              â–¼
   [Toss PG API]                 [Nice PG API]
```

**í•µì‹¬ ê°œë…:**

- âœ… **Port (ì¸í„°í˜ì´ìŠ¤)**: ë„ë©”ì¸ì´ ì™¸ë¶€ ì„¸ê³„ì™€ í†µì‹ í•˜ëŠ” ì§„ì…ì 
- âœ… **Adapter (êµ¬í˜„ì²´)**: Portë¥¼ êµ¬í˜„í•˜ì—¬ ì‹¤ì œ ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ í†µì‹ 
- âœ… **ì˜ì¡´ì„± ì—­ì „**: ë„ë©”ì¸ì€ êµ¬ì²´ì ì¸ êµ¬í˜„ì²´ë¥¼ ëª¨ë¦„
- âœ… **í™•ì¥ì„±**: ìƒˆë¡œìš´ Adapter ì¶”ê°€ ì‹œ ë„ë©”ì¸ ì½”ë“œ ë³€ê²½ ì—†ìŒ

---

## ğŸ“‹ PaymentPort ì¸í„°í˜ì´ìŠ¤ ì •ì˜

### ì „ì²´ ì¸í„°í˜ì´ìŠ¤ êµ¬ì¡°

```java
package com.payment.port;

/**
 * ê²°ì œ ì„œë¹„ìŠ¤ì˜ Port (í¬íŠ¸) ì¸í„°í˜ì´ìŠ¤
 * Hexagonal Architectureì˜ í•µì‹¬ ì¶”ìƒí™”
 *
 * ëª¨ë“  PGì‚¬ AdapterëŠ” ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•¨
 */
public interface PaymentPort {

  /**
   * ê²°ì œ ìš”ì²­
   *
   * @param payload ê²°ì œ ìš”ì²­ ë°ì´í„°
   * @param runnable ì„±ê³µ/ì‹¤íŒ¨ ì½œë°±
   * @return ê²°ì œ ì‘ë‹µ
   */
  PaymentResponse payment(
      PaymentRequest payload,
      PaymentAdapterRunnable<BaseResponse> runnable
  );

  /**
   * ê²°ì œ ì •ë³´ ì¡°íšŒ
   *
   * @param payload ì¡°íšŒ ìš”ì²­ ë°ì´í„°
   * @return ì¡°íšŒ ê²°ê³¼
   */
  ReadResponse read(ReadRequest payload);

  /**
   * í™˜ë¶ˆ ìš”ì²­
   *
   * @param payload í™˜ë¶ˆ ìš”ì²­ ë°ì´í„°
   * @param runnable ì„±ê³µ/ì‹¤íŒ¨ ì½œë°±
   * @return í™˜ë¶ˆ ì‘ë‹µ
   */
  RefundResponse refund(
      RefundRequest payload,
      PaymentAdapterRunnable<RefundResponse> runnable
  );

  /**
   * ê²°ì œ ì²­êµ¬ì„œ ì¹´ì¹´ì˜¤í†¡ ì „ì†¡
   *
   * @param payload ì²­êµ¬ì„œ ì „ì†¡ ë°ì´í„°
   * @param runnable ì„±ê³µ/ì‹¤íŒ¨ ì½œë°±
   * @return ì „ì†¡ ê²°ê³¼
   */
  KakaoTalkResponse sendBill(
      TalkRequest payload,
      PaymentAdapterRunnable<KakaoTalkResponse> runnable
  );

  /**
   * ê²°ì œ ì²­êµ¬ì„œ íŒŒê¸°
   *
   * @param payload íŒŒê¸° ìš”ì²­ ë°ì´í„°
   * @param successRunnable ì„±ê³µ ì½œë°±
   * @return íŒŒê¸° ê²°ê³¼
   */
  DestroyResponse destroy(
      DestroyRequest payload,
      PaymentAdapterRunnable<DestroyResponse> successRunnable
  );

  /**
   * ê²°ì œ ìš”ì²­ ê²°ê³¼ Callback ì²˜ë¦¬
   * (PGì‚¬ë¡œë¶€í„° Webhook ìˆ˜ì‹ )
   *
   * @param payload PGì‚¬ë¡œë¶€í„° ë°›ì€ ì½œë°± ë°ì´í„°
   * @param hash ë³´ì•ˆ í•´ì‹œê°’
   * @return ì½œë°± ì²˜ë¦¬ ê²°ê³¼
   */
  default PaymentCallbackResponse callback(
      PaymentCallbackRequest payload,
      String hash
  ) {
    return null; // ê¸°ë³¸ êµ¬í˜„: null ë°˜í™˜ (êµ¬í˜„ì²´ì—ì„œ ì˜¤ë²„ë¼ì´ë“œ)
  }
}
```

### ë©”ì„œë“œë³„ ì±…ì„ ì •ì˜

#### 1ï¸âƒ£ payment() - ê²°ì œ ìš”ì²­

**ëª©ì :** ì‹¤ì œ ê²°ì œ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰

**íŠ¹ì§•:**

- ë™ê¸° ì²˜ë¦¬ (ì‘ë‹µ ëŒ€ê¸°)
- UUID ìƒì„± ì½œë°± í¬í•¨ (ì¦‰ì‹œ ì‘ë‹µìš©)
- ì„±ê³µ/ì‹¤íŒ¨ ì½œë°± ì‹¤í–‰

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**

- ìë™ ê²°ì œ (ë¹Œë§í‚¤ ì‚¬ìš©)
- ì¦‰ì‹œ ê²°ì œ (ì¹´ë“œ ì •ë³´ ì§ì ‘ ì…ë ¥)

#### 2ï¸âƒ£ read() - ê²°ì œ ì¡°íšŒ

**ëª©ì :** ê¸°ì¡´ ê²°ì œ ë‚´ì—­ ì¡°íšŒ

**íŠ¹ì§•:**

- ë‹¨ìˆœ ì¡°íšŒ (ì½œë°± ë¶ˆí•„ìš”)
- ë©±ë“±ì„± ë³´ì¥ (ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•´ë„ ë™ì¼ ê²°ê³¼)

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**

- ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ê²°ì œ ë‚´ì—­ í™•ì¸
- ê²°ì œ ìƒíƒœ í´ë§

#### 3ï¸âƒ£ refund() - í™˜ë¶ˆ ì²˜ë¦¬

**ëª©ì :** ê²°ì œ ì·¨ì†Œ ë° í™˜ë¶ˆ

**íŠ¹ì§•:**

- ì›ë³¸ ê²°ì œ íŠ¸ëœì­ì…˜ í•„ìš”
- ë¶€ë¶„ í™˜ë¶ˆ ì§€ì›
- í™˜ë¶ˆ ì„±ê³µ/ì‹¤íŒ¨ ì½œë°±

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**

- ê³ ê° ìš”ì²­ í™˜ë¶ˆ
- ìë™ í™˜ë¶ˆ (ì •ì±… ìœ„ë°˜ ë“±)

#### 4ï¸âƒ£ sendBill() - ì²­êµ¬ì„œ ë°œì†¡

**ëª©ì :** ì¹´ì¹´ì˜¤í†¡ ì²­êµ¬ì„œ ë°œì†¡

**íŠ¹ì§•:**

- ë¹„íšŒì› ê²°ì œ ì§€ì›
- ìœ íš¨ ê¸°ê°„ ì„¤ì • ê°€ëŠ¥
- ì²­êµ¬ì„œ URL ìƒì„±

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**

- ê²°ì œ ìˆ˜ë‹¨ ë¯¸ë“±ë¡ íšŒì›
- ë¹„íšŒì› ê²°ì œ
- ëŒ€ëŸ‰ ì²­êµ¬ì„œ ë°œì†¡

#### 5ï¸âƒ£ destroy() - ì²­êµ¬ì„œ íŒŒê¸°

**ëª©ì :** ë°œê¸‰ëœ ì²­êµ¬ì„œ ë¬´íš¨í™”

**íŠ¹ì§•:**

- ì²­êµ¬ì„œ ë§Œë£Œ ì²˜ë¦¬
- ë” ì´ìƒ ê²°ì œ ë¶ˆê°€

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**

- ê³ ê° ìš”ì²­ ì·¨ì†Œ
- ì •ì±… ìœ„ë°˜ ì²­êµ¬ì„œ íŒŒê¸°
- ìë™ ë§Œë£Œ ì²˜ë¦¬

#### 6ï¸âƒ£ callback() - Webhook ì²˜ë¦¬

**ëª©ì :** PGì‚¬ë¡œë¶€í„° ê²°ì œ ê²°ê³¼ ìˆ˜ì‹ 

**íŠ¹ì§•:**

- default ë©”ì„œë“œ (ì„ íƒì  êµ¬í˜„)
- ë¹„ë™ê¸° í†µì§€
- í•´ì‹œ ê²€ì¦ í•„ìˆ˜

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**

- ì²­êµ¬ì„œ ê²°ì œ ì™„ë£Œ í†µì§€
- ìë™ ê²°ì œ ê²°ê³¼ í†µì§€

---

## ğŸ­ PaymentPortFactory êµ¬í˜„

### Factory Pattern ì ìš©

```java
package com.payment.factory;

import com.payment.port.PaymentPort;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

/**
 * PaymentPort êµ¬í˜„ì²´ë¥¼ ìƒì„±í•˜ëŠ” Factory í´ë˜ìŠ¤
 * Strategy Pattern + Factory Pattern ì¡°í•©
 */
@Slf4j
@Component
public class PaymentPortFactory {

  private final Map<String, PaymentPort> adapterMap;

  /**
   * Springì´ ëª¨ë“  PaymentPort êµ¬í˜„ì²´ë¥¼ ìë™ ì£¼ì…
   */
  public PaymentPortFactory(List<PaymentPort> adapters) {
    this.adapterMap = adapters.stream()
        .collect(Collectors.toMap(
            adapter -> extractPgCompanyName(adapter),
            adapter -> adapter
        ));

    log.info("ë“±ë¡ëœ Payment Adapter: {}", adapterMap.keySet());
  }

  /**
   * PGì‚¬ ì½”ë“œë¡œ ì ì ˆí•œ Adapter ë°˜í™˜
   *
   * @param pgCompany PGì‚¬ ì½”ë“œ (TOSS, NICE, KAKAO, etc.)
   * @return PaymentPort êµ¬í˜„ì²´
   * @throws IllegalArgumentException ì§€ì›í•˜ì§€ ì•ŠëŠ” PGì‚¬ì¸ ê²½ìš°
   */
  public PaymentPort create(String pgCompany) {
    PaymentPort adapter = adapterMap.get(pgCompany.toUpperCase());

    if (adapter == null) {
      throw new IllegalArgumentException(
          String.format("ì§€ì›í•˜ì§€ ì•ŠëŠ” PGì‚¬ì…ë‹ˆë‹¤: %s (ì‚¬ìš© ê°€ëŠ¥: %s)",
              pgCompany,
              String.join(", ", adapterMap.keySet()))
      );
    }

    log.debug("PG Adapter ì„ íƒ: {} -> {}", pgCompany, adapter.getClass().getSimpleName());
    return adapter;
  }

  /**
   * Adapter í´ë˜ìŠ¤ëª…ì—ì„œ PGì‚¬ ì´ë¦„ ì¶”ì¶œ
   * ì˜ˆ: TossAdapter -> TOSS
   */
  private String extractPgCompanyName(PaymentPort adapter) {
    String className = adapter.getClass().getSimpleName();
    return className
        .replace("Adapter", "")
        .replace("PaymentAdapter", "")
        .toUpperCase();
  }

  /**
   * ë“±ë¡ëœ ëª¨ë“  PGì‚¬ ëª©ë¡ ë°˜í™˜
   */
  public List<String> getSupportedPgCompanies() {
    return List.copyOf(adapterMap.keySet());
  }

  /**
   * íŠ¹ì • PGì‚¬ ì§€ì› ì—¬ë¶€ í™•ì¸
   */
  public boolean supports(String pgCompany) {
    return adapterMap.containsKey(pgCompany.toUpperCase());
  }
}
```

### Factory ì‚¬ìš© ì˜ˆì‹œ

```java
@Service
@RequiredArgsConstructor
public class PaymentService {

  private final PaymentPortFactory factory;

  /**
   * ë™ì ìœ¼ë¡œ PGì‚¬ ì„ íƒí•˜ì—¬ ê²°ì œ
   */
  public PaymentResponse processPayment(
      String pgCompany,
      PaymentRequest request) {

    // 1. Factoryì—ì„œ ì ì ˆí•œ Adapter ê°€ì ¸ì˜¤ê¸°
    PaymentPort port = factory.create(pgCompany);

    // 2. ê²°ì œ ì²˜ë¦¬
    return port.payment(
        request,
        PaymentAdapterRunnable.paymentRunnable(
            uuid -> log.info("ê²°ì œ ì‹œì‘: {}", uuid),
            (uuid, response) -> log.info("ê²°ì œ ì„±ê³µ: {}", uuid),
            (uuid, error) -> log.error("ê²°ì œ ì‹¤íŒ¨: {}", uuid, error)
        )
    );
  }

  /**
   * ì§€ì› ê°€ëŠ¥í•œ PGì‚¬ ëª©ë¡ ì¡°íšŒ
   */
  public List<String> getAvailablePaymentGateways() {
    return factory.getSupportedPgCompanies();
  }
}
```

---

## ğŸ¨ DTO ì„¤ê³„

### Request DTO (ê³µí†µ)

```java
/**
 * ê³µí†µ ê²°ì œ ìš”ì²­ DTO
 * PGì‚¬ì— ë…ë¦½ì ì¸ ë„ë©”ì¸ ê°ì²´
 */
@Getter
@Builder
public class PaymentRequest {

  private String orderId;          // ì£¼ë¬¸ ID
  private Long amount;             // ê²°ì œ ê¸ˆì•¡
  private String currency;         // í†µí™” (KRW, USD, etc.)
  private String billingKey;       // ë¹Œë§í‚¤ (ìë™ê²°ì œìš©)
  private String customerName;     // ê³ ê°ëª…
  private String customerEmail;    // ê³ ê° ì´ë©”ì¼
  private String customerPhone;    // ê³ ê° ì—°ë½ì²˜
  private String productName;      // ìƒí’ˆëª…
  private Map<String, Object> metadata; // ì¶”ê°€ ì •ë³´

  /**
   * Entityë¡œ ë³€í™˜
   */
  public Transaction toEntity() {
    return Transaction.builder()
        .orderId(orderId)
        .amount(amount)
        .currency(currency)
        .status("PENDING")
        .build();
  }
}
```

### Response DTO (ê³µí†µ)

```java
/**
 * ê³µí†µ ê²°ì œ ì‘ë‹µ DTO
 */
@Getter
@Builder
public class PaymentResponse {

  private String transactionId;    // íŠ¸ëœì­ì…˜ ID (UUID)
  private String pgTransactionId;  // PGì‚¬ íŠ¸ëœì­ì…˜ ID
  private PaymentStatus status;    // ê²°ì œ ìƒíƒœ
  private String message;          // ì‘ë‹µ ë©”ì‹œì§€
  private Long paidAmount;         // ì‹¤ì œ ê²°ì œ ê¸ˆì•¡
  private LocalDateTime paidAt;    // ê²°ì œ ì™„ë£Œ ì‹œê°„

  // PGì‚¬ ì›ë³¸ ë°ì´í„° (ë””ë²„ê¹…ìš©)
  private Object rawData;

  /**
   * ì„±ê³µ ì‘ë‹µ ìƒì„±
   */
  public static PaymentResponse success(
      String transactionId,
      String pgTransactionId,
      Long paidAmount) {

    return PaymentResponse.builder()
        .transactionId(transactionId)
        .pgTransactionId(pgTransactionId)
        .status(PaymentStatus.SUCCESS)
        .message("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤")
        .paidAmount(paidAmount)
        .paidAt(LocalDateTime.now())
        .build();
  }

  /**
   * ì‹¤íŒ¨ ì‘ë‹µ ìƒì„±
   */
  public static PaymentResponse failure(
      String transactionId,
      String errorMessage) {

    return PaymentResponse.builder()
        .transactionId(transactionId)
        .status(PaymentStatus.FAILED)
        .message(errorMessage)
        .build();
  }
}

/**
 * ê²°ì œ ìƒíƒœ Enum
 */
public enum PaymentStatus {
  PENDING("ëŒ€ê¸° ì¤‘"),
  SUCCESS("ì„±ê³µ"),
  FAILED("ì‹¤íŒ¨"),
  CANCELLED("ì·¨ì†Œë¨"),
  REFUNDED("í™˜ë¶ˆë¨");

  private final String description;

  PaymentStatus(String description) {
    this.description = description;
  }
}
```

---

## ğŸ”— ì „ì²´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

### ê³„ì¸µë³„ ì˜ì¡´ì„± ê´€ê³„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Presentation Layer                        â”‚
â”‚  - PaymentController                                 â”‚
â”‚  - WebhookController                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ depends on
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Application Layer                         â”‚
â”‚  - PaymentService (ë„ë©”ì¸ ë¡œì§)                      â”‚
â”‚  - PaymentPortFactory (Adapter ì„ íƒ)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ depends on
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Domain Layer (Interface)                  â”‚
â”‚  - PaymentPort <<interface>>                        â”‚
â”‚  - PaymentRequest / PaymentResponse (ê³µí†µ DTO)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ implemented by
          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼             â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Infrastructure Layer (Adapters)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚TossAdapter  â”‚NiceAdapter  â”‚KakaoAdapter â”‚
â”‚- TossPgClientâ”‚- NicePgClientâ”‚- KakaoPgClientâ”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚             â”‚             â”‚
      â–¼             â–¼             â–¼
  [Toss API]   [Nice API]   [Kakao API]
```

### ìš”ì²­ ì²˜ë¦¬ íë¦„

```
1. Controller
   â””â†’ @PostMapping("/payments")
       â””â†’ PaymentService.processPayment()

2. Service
   â””â†’ PaymentPortFactory.create("TOSS")
       â””â†’ TossAdapter ë°˜í™˜

3. Adapter
   â””â†’ TossPgClient.payment()
       â””â†’ HTTP POST https://api.tosspayments.com/v1/payments

4. PG API
   â””â†’ ê²°ì œ ìŠ¹ì¸ ì²˜ë¦¬
       â””â†’ ì‘ë‹µ ë°˜í™˜

5. Adapter
   â””â†’ TossPaymentResponse â†’ PaymentResponse ë³€í™˜
       â””â†’ Runnable ì½œë°± ì‹¤í–‰

6. Service
   â””â†’ OrderService.updateStatus()
       â””â†’ NotificationService.sendEmail()

7. Controller
   â””â†’ ResponseEntity<PaymentResponse> ë°˜í™˜
```

---

## ğŸš€ í™•ì¥ í¬ì¸íŠ¸

### 1ï¸âƒ£ ìƒˆë¡œìš´ PGì‚¬ ì¶”ê°€

```java
/**
 * ì¹´ì¹´ì˜¤í˜ì´ Adapter ì¶”ê°€
 */
@Component
@RequiredArgsConstructor
public class KakaoPayAdapter implements PaymentPort {

  private final KakaoPgClient kakaoPgClient;
  private final TransactionService transactionService;

  @Override
  public PaymentResponse payment(
      PaymentRequest payload,
      PaymentAdapterRunnable<BaseResponse> runnable) {

    // ì¹´ì¹´ì˜¤í˜ì´ ì „ìš© ë¡œì§ êµ¬í˜„
    KakaoPaymentResponse response = kakaoPgClient.payment(
        KakaoPaymentRequest.from(payload)
    );

    // ê³µí†µ ì‘ë‹µìœ¼ë¡œ ë³€í™˜
    return PaymentResponse.success(/*...*/);
  }

  // ë‹¤ë¥¸ ë©”ì„œë“œ êµ¬í˜„...
}
```

**ê²°ê³¼:**

- âœ… PaymentPortFactoryê°€ ìë™ìœ¼ë¡œ ê°ì§€
- âœ… ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ì´ ì‚¬ìš© ê°€ëŠ¥
- âœ… `factory.create("KAKAO")` ë¡œ ì¦‰ì‹œ ì‚¬ìš©

### 2ï¸âƒ£ ìƒˆë¡œìš´ ê²°ì œ ë°©ì‹ ì¶”ê°€

```java
/**
 * ê°€ìƒê³„ì¢Œ ê²°ì œ ë©”ì„œë“œ ì¶”ê°€
 */
public interface PaymentPort {

  // ê¸°ì¡´ ë©”ì„œë“œë“¤...

  /**
   * ê°€ìƒê³„ì¢Œ ë°œê¸‰ (ìƒˆë¡œìš´ ë©”ì„œë“œ)
   */
  default VirtualAccountResponse issueVirtualAccount(
      VirtualAccountRequest payload,
      PaymentAdapterRunnable<VirtualAccountResponse> runnable) {

    throw new UnsupportedOperationException(
        "ì´ PGì‚¬ëŠ” ê°€ìƒê³„ì¢Œë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
    );
  }
}
```

**ê²°ê³¼:**

- âœ… default ë©”ì„œë“œë¡œ ê¸°ë³¸ êµ¬í˜„ ì œê³µ
- âœ… ì§€ì›í•˜ëŠ” Adapterë§Œ ì˜¤ë²„ë¼ì´ë“œ
- âœ… ê¸°ì¡´ AdapterëŠ” ì˜í–¥ ì—†ìŒ

### 3ï¸âƒ£ ë‹¤ì¤‘ PGì‚¬ ì „ëµ

```java
/**
 * ì—¬ëŸ¬ PGì‚¬ë¥¼ ë™ì‹œì— ì§€ì›í•˜ëŠ” ì „ëµ
 */
@Service
@RequiredArgsConstructor
public class MultiPgPaymentService {

  private final PaymentPortFactory factory;

  /**
   * Primary PG ì‹¤íŒ¨ ì‹œ Fallback PG ì‹œë„
   */
  public PaymentResponse processWithFallback(PaymentRequest request) {

    List<String> pgPriority = List.of("TOSS", "NICE", "KAKAO");

    for (String pgCompany : pgPriority) {
      try {
        PaymentPort port = factory.create(pgCompany);
        return port.payment(request, createRunnable());

      } catch (Exception e) {
        log.warn("PG {} ì‹¤íŒ¨, ë‹¤ìŒ PG ì‹œë„", pgCompany, e);
      }
    }

    throw new PaymentException("ëª¨ë“  PGì‚¬ ê²°ì œ ì‹¤íŒ¨");
  }

  /**
   * ê¸ˆì•¡ì— ë”°ë¼ PGì‚¬ ì„ íƒ
   */
  public PaymentResponse processWithAmountBasedSelection(
      PaymentRequest request) {

    String pgCompany = request.getAmount() > 100000
        ? "TOSS"   // ê³ ì•¡ ê²°ì œ: Toss
        : "NICE";  // ì†Œì•¡ ê²°ì œ: Nice

    PaymentPort port = factory.create(pgCompany);
    return port.payment(request, createRunnable());
  }
}
```

---

## ğŸ’¡ Best Practices

### 1ï¸âƒ£ Interface Segregation

```java
// âœ… Good: ì±…ì„ ë¶„ë¦¬
public interface PaymentPort {
  PaymentResponse payment(...);
  ReadResponse read(...);
}

public interface RefundPort {
  RefundResponse refund(...);
}

// AdapterëŠ” í•„ìš”í•œ ì¸í„°í˜ì´ìŠ¤ë§Œ êµ¬í˜„
public class TossAdapter implements PaymentPort, RefundPort {
  // ...
}
```

### 2ï¸âƒ£ Null Object Pattern

```java
/**
 * Null Object Pattern ì ìš©
 */
@Component
public class NullPaymentAdapter implements PaymentPort {

  @Override
  public PaymentResponse payment(...) {
    return PaymentResponse.failure(null, "PGì‚¬ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤");
  }

  // ë‹¤ë¥¸ ë©”ì„œë“œë„ ë™ì¼í•˜ê²Œ êµ¬í˜„
}

// Factoryì—ì„œ ì‚¬ìš©
public PaymentPort create(String pgCompany) {
  return adapterMap.getOrDefault(pgCompany, nullPaymentAdapter);
}
```

### 3ï¸âƒ£ Builder Pattern í™œìš©

```java
/**
 * ë³µì¡í•œ Request ìƒì„± ì‹œ Builder ì‚¬ìš©
 */
PaymentRequest request = PaymentRequest.builder()
    .orderId("ORDER_123")
    .amount(10000L)
    .currency("KRW")
    .customerName("í™ê¸¸ë™")
    .customerEmail("hong@example.com")
    .productName("í…ŒìŠ¤íŠ¸ ìƒí’ˆ")
    .metadata(Map.of("source", "mobile"))
    .build();
```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] PaymentPort ì¸í„°í˜ì´ìŠ¤ ì •ì˜ ì™„ë£Œ
- [ ] PaymentPortFactory êµ¬í˜„ ì™„ë£Œ
- [ ] ëª¨ë“  Adapterê°€ PaymentPort êµ¬í˜„
- [ ] ê³µí†µ Request/Response DTO ì •ì˜
- [ ] Factory í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
- [ ] í™•ì¥ í¬ì¸íŠ¸ ë¬¸ì„œí™”
- [ ] ë‹¤ì¤‘ PG ì „ëµ êµ¬í˜„ (ì„ íƒ)
- [ ] Null Object Pattern ì ìš© (ì„ íƒ)

---

## ğŸ‰ ê²°ë¡ 

### ë‹¬ì„±í•œ ëª©í‘œ

| ëª©í‘œ | ìƒíƒœ | ê²°ê³¼ |
|------|------|------|
| **ë…ë¦½ì„±** | âœ… | ê²°ì œ ì„œë¹„ìŠ¤ ë…ë¦½ ë°°í¬ ê°€ëŠ¥ |
| **í™•ì¥ì„±** | âœ… | ìƒˆë¡œìš´ PGì‚¬ ì¶”ê°€ ìš©ì´ (ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ìŒ) |
| **ìœ ì§€ë³´ìˆ˜ì„±** | âœ… | ëª…í™•í•œ ì±…ì„ ë¶„ë¦¬ ë° í…ŒìŠ¤íŠ¸ ìš©ì´ |
| **ì„±ëŠ¥** | âœ… | ë…ë¦½ì ì¸ ìŠ¤ì¼€ì¼ë§ ê°€ëŠ¥ |

### ìµœì¢… ì•„í‚¤í…ì²˜ íŠ¹ì§•

1. **Clean Architecture**: ë„ë©”ì¸ ë¡œì§ì´ ì¸í”„ë¼ì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
2. **SOLID ì›ì¹™ ì¤€ìˆ˜**: ëª¨ë“  5ê°€ì§€ ì›ì¹™ ì ìš©
3. **í™•ì¥ ê°€ëŠ¥**: ìƒˆë¡œìš´ ìš”êµ¬ì‚¬í•­ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘
4. **í…ŒìŠ¤íŠ¸ ìš©ì´**: Mock ê°ì²´ë¡œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ê°„í¸

### ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

- ğŸ“Š **ëª¨ë‹ˆí„°ë§**: ê²°ì œ ì„±ê³µë¥ , ì‘ë‹µ ì‹œê°„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- ğŸ”’ **ë³´ì•ˆ ê°•í™”**: API Key ì•”í˜¸í™”, ìš”ì²­/ì‘ë‹µ ê²€ì¦ ê°•í™”
- ğŸš€ **ì„±ëŠ¥ ìµœì í™”**: ìºì‹± ì „ëµ, ë¹„ë™ê¸° ì²˜ë¦¬ ë„ì…
- ğŸ“± **ì•Œë¦¼ ì‹œìŠ¤í…œ**: ê²°ì œ ì‹¤íŒ¨ ì‹œ ê´€ë¦¬ì ì‹¤ì‹œê°„ ì•Œë¦¼

---

## ğŸ”— ì „ì²´ ì‹œë¦¬ì¦ˆ ë§í¬

1. [0. Intro: ê²°ì œ ì„œë¹„ìŠ¤ MSA ì „í™˜ ì—¬ì •](/Back-End/ê²°ì œ-ì„œë¹„ìŠ¤-MSA-ì•„í‚¤í…ì³-ì „í™˜/0-Intro)
2. [1. Legacy DB í…Œì´ë¸” ì •ë¦¬](/Back-End/ê²°ì œ-ì„œë¹„ìŠ¤-MSA-ì•„í‚¤í…ì³-ì „í™˜/1-Legacy-DB-í…Œì´ë¸”-ì •ë¦¬)
3. [2. ì–´ëŒ‘í„° íŒ¨í„´ ì„¤ê³„](/Back-End/ê²°ì œ-ì„œë¹„ìŠ¤-MSA-ì•„í‚¤í…ì³-ì „í™˜/2-ì–´ëŒ‘í„°-íŒ¨í„´-ì„¤ê³„)
4. [3. ì–´ëŒ‘í„° êµ¬í˜„ì²´ ì„¤ê³„](/Back-End/ê²°ì œ-ì„œë¹„ìŠ¤-MSA-ì•„í‚¤í…ì³-ì „í™˜/3-ì–´ëŒ‘í„°-êµ¬í˜„ì²´-ì„¤ê³„)
5. [4. PGì‚¬ ì™¸ë¶€ API ìš”ì²­ RestClient](/Back-End/ê²°ì œ-ì„œë¹„ìŠ¤-MSA-ì•„í‚¤í…ì³-ì „í™˜/4-PGì‚¬-ì™¸ë¶€-API-ìš”ì²­-RestClient)
6. [5. Runnable íŒ¨í„´ êµ¬í˜„](/Back-End/ê²°ì œ-ì„œë¹„ìŠ¤-MSA-ì•„í‚¤í…ì³-ì „í™˜/5-Runnable-íŒ¨í„´-êµ¬í˜„)

**MSA ì „í™˜ ì™„ë£Œ! ì¶•í•˜í•©ë‹ˆë‹¤!** ğŸ‰