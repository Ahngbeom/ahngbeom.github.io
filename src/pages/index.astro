---
import BaseLayout from '../layouts/BaseLayout.astro';
import CategoryNav from '../components/CategoryNav.astro';
import Pagination from '../components/Pagination.astro';
import PostCard from '../components/PostCard.astro';
import { getCategorySummaries, getPublishedPosts, paginatePosts } from '../lib/content';
import { siteConfig } from '../config/site';

const allPosts = await getPublishedPosts();
const categories = getCategorySummaries(allPosts);
const pagination = paginatePosts(allPosts, 1, siteConfig.layout.postsPerPage);
---

<BaseLayout>
  <section class="home-grid">
    <CategoryNav categories={categories} />
    <section class="posts">
      <h2 class="section-title">Recent Posts</h2>
      <p class="meta">Latest writing across architecture, frontend, backend, and retrospectives.</p>
      <div class="post-list">
        {pagination.items.map((post) => (
          <PostCard post={post} />
        ))}
      </div>
      <Pagination currentPage={pagination.currentPage} totalPages={pagination.totalPages} />
    </section>
  </section>
</BaseLayout>

<style>
  .home-grid {
    margin-top: 1.2rem;
    display: grid;
    grid-template-columns: 280px minmax(0, 1fr);
    gap: 1rem;
    align-items: start;
  }

  .posts {
    min-width: 0;
  }

  .posts .meta {
    margin: 0.35rem 0 0;
  }

  .post-list {
    margin-top: 1rem;
    display: grid;
    gap: 0.8rem;
  }

  @media (max-width: 980px) {
    .home-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
